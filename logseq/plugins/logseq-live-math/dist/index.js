"use strict";(()=>{var To=Object.create;var Cr=Object.defineProperty;var Io=Object.getOwnPropertyDescriptor;var Fo=Object.getOwnPropertyNames;var $o=Object.getPrototypeOf,No=Object.prototype.hasOwnProperty;var Sr=(j,g)=>()=>(g||j((g={exports:{}}).exports,g),g.exports);var Po=(j,g,k,X)=>{if(g&&typeof g=="object"||typeof g=="function")for(let S of Fo(g))!No.call(j,S)&&S!==k&&Cr(j,S,{get:()=>g[S],enumerable:!(X=Io(g,S))||X.enumerable});return j};var Er=(j,g,k)=>(k=j!=null?To($o(j)):{},Po(g||!j||!j.__esModule?Cr(k,"default",{value:j,enumerable:!0}):k,j));var Ar=Sr((It,Ht)=>{(function(j,g){typeof It=="object"&&typeof Ht=="object"?Ht.exports=g():typeof define=="function"&&define.amd?define([],g):typeof It=="object"?It.LSPluginEntry=g():j.LSPluginEntry=g()})(self,()=>(()=>{var j={227:(S,c,y)=>{var _=y(155);c.formatArgs=function(T){if(T[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+T[0]+(this.useColors?"%c ":" ")+"+"+S.exports.humanize(this.diff),!this.useColors)return;let K="color: "+this.color;T.splice(1,0,K,"color: inherit");let x=0,p=0;T[0].replace(/%[a-zA-Z%]/g,E=>{E!=="%%"&&(x++,E==="%c"&&(p=x))}),T.splice(p,0,K)},c.save=function(T){try{T?c.storage.setItem("debug",T):c.storage.removeItem("debug")}catch{}},c.load=function(){let T;try{T=c.storage.getItem("debug")}catch{}return!T&&_!==void 0&&"env"in _&&(T=_.env.DEBUG),T},c.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},c.storage=function(){try{return localStorage}catch{}}(),c.destroy=(()=>{let T=!1;return()=>{T||(T=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],c.log=console.debug||console.log||(()=>{}),S.exports=y(447)(c);let{formatters:s}=S.exports;s.j=function(T){try{return JSON.stringify(T)}catch(K){return"[UnexpectedJSONParseError]: "+K.message}}},447:(S,c,y)=>{S.exports=function(_){function s(x){let p,E,h,C=null;function w(...$){if(!w.enabled)return;let q=w,F=Number(new Date),N=F-(p||F);q.diff=N,q.prev=p,q.curr=F,p=F,$[0]=s.coerce($[0]),typeof $[0]!="string"&&$.unshift("%O");let i=0;$[0]=$[0].replace(/%([a-zA-Z%])/g,(d,v)=>{if(d==="%%")return"%";i++;let b=s.formatters[v];if(typeof b=="function"){let W=$[i];d=b.call(q,W),$.splice(i,1),i--}return d}),s.formatArgs.call(q,$),(q.log||s.log).apply(q,$)}return w.namespace=x,w.useColors=s.useColors(),w.color=s.selectColor(x),w.extend=T,w.destroy=s.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>C!==null?C:(E!==s.namespaces&&(E=s.namespaces,h=s.enabled(x)),h),set:$=>{C=$}}),typeof s.init=="function"&&s.init(w),w}function T(x,p){let E=s(this.namespace+(p===void 0?":":p)+x);return E.log=this.log,E}function K(x){return x.toString().substring(2,x.toString().length-2).replace(/\.\*\?$/,"*")}return s.debug=s,s.default=s,s.coerce=function(x){return x instanceof Error?x.stack||x.message:x},s.disable=function(){let x=[...s.names.map(K),...s.skips.map(K).map(p=>"-"+p)].join(",");return s.enable(""),x},s.enable=function(x){let p;s.save(x),s.namespaces=x,s.names=[],s.skips=[];let E=(typeof x=="string"?x:"").split(/[\s,]+/),h=E.length;for(p=0;p<h;p++)E[p]&&((x=E[p].replace(/\*/g,".*?"))[0]==="-"?s.skips.push(new RegExp("^"+x.slice(1)+"$")):s.names.push(new RegExp("^"+x+"$")))},s.enabled=function(x){if(x[x.length-1]==="*")return!0;let p,E;for(p=0,E=s.skips.length;p<E;p++)if(s.skips[p].test(x))return!1;for(p=0,E=s.names.length;p<E;p++)if(s.names[p].test(x))return!0;return!1},s.humanize=y(824),s.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(_).forEach(x=>{s[x]=_[x]}),s.names=[],s.skips=[],s.formatters={},s.selectColor=function(x){let p=0;for(let E=0;E<x.length;E++)p=(p<<5)-p+x.charCodeAt(E),p|=0;return s.colors[Math.abs(p)%s.colors.length]},s.enable(s.load()),s}},996:S=>{"use strict";var c=function(h){return function(C){return!!C&&typeof C=="object"}(h)&&!function(C){var w=Object.prototype.toString.call(C);return w==="[object RegExp]"||w==="[object Date]"||function($){return $.$$typeof===y}(C)}(h)},y=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function _(h,C){return C.clone!==!1&&C.isMergeableObject(h)?p((w=h,Array.isArray(w)?[]:{}),h,C):h;var w}function s(h,C,w){return h.concat(C).map(function($){return _($,w)})}function T(h){return Object.keys(h).concat(function(C){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(C).filter(function(w){return Object.propertyIsEnumerable.call(C,w)}):[]}(h))}function K(h,C){try{return C in h}catch{return!1}}function x(h,C,w){var $={};return w.isMergeableObject(h)&&T(h).forEach(function(q){$[q]=_(h[q],w)}),T(C).forEach(function(q){(function(F,N){return K(F,N)&&!(Object.hasOwnProperty.call(F,N)&&Object.propertyIsEnumerable.call(F,N))})(h,q)||(K(h,q)&&w.isMergeableObject(C[q])?$[q]=function(F,N){if(!N.customMerge)return p;var i=N.customMerge(F);return typeof i=="function"?i:p}(q,w)(h[q],C[q],w):$[q]=_(C[q],w))}),$}function p(h,C,w){(w=w||{}).arrayMerge=w.arrayMerge||s,w.isMergeableObject=w.isMergeableObject||c,w.cloneUnlessOtherwiseSpecified=_;var $=Array.isArray(C);return $===Array.isArray(h)?$?w.arrayMerge(h,C,w):x(h,C,w):_(C,w)}p.all=function(h,C){if(!Array.isArray(h))throw new Error("first argument should be an array");return h.reduce(function(w,$){return p(w,$,C)},{})};var E=p;S.exports=E},856:function(S){S.exports=function(){"use strict";function c(M){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},c(M)}function y(M,P){return y=Object.setPrototypeOf||function(B,Z){return B.__proto__=Z,B},y(M,P)}function _(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function s(M,P,B){return s=_()?Reflect.construct:function(Z,pt,Nt){var Wt=[null];Wt.push.apply(Wt,pt);var ne=new(Function.bind.apply(Z,Wt));return Nt&&y(ne,Nt.prototype),ne},s.apply(null,arguments)}function T(M){return K(M)||x(M)||p(M)||h()}function K(M){if(Array.isArray(M))return E(M)}function x(M){if(typeof Symbol<"u"&&M[Symbol.iterator]!=null||M["@@iterator"]!=null)return Array.from(M)}function p(M,P){if(M){if(typeof M=="string")return E(M,P);var B=Object.prototype.toString.call(M).slice(8,-1);return B==="Object"&&M.constructor&&(B=M.constructor.name),B==="Map"||B==="Set"?Array.from(M):B==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(B)?E(M,P):void 0}}function E(M,P){(P==null||P>M.length)&&(P=M.length);for(var B=0,Z=new Array(P);B<P;B++)Z[B]=M[B];return Z}function h(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var C=Object.hasOwnProperty,w=Object.setPrototypeOf,$=Object.isFrozen,q=Object.getPrototypeOf,F=Object.getOwnPropertyDescriptor,N=Object.freeze,i=Object.seal,d=Object.create,v=typeof Reflect<"u"&&Reflect,b=v.apply,W=v.construct;b||(b=function(M,P,B){return M.apply(P,B)}),N||(N=function(M){return M}),i||(i=function(M){return M}),W||(W=function(M,P){return s(M,T(P))});var et=tt(Array.prototype.forEach),it=tt(Array.prototype.pop),dt=tt(Array.prototype.push),bt=tt(String.prototype.toLowerCase),_t=tt(String.prototype.match),yt=tt(String.prototype.replace),Ee=tt(String.prototype.indexOf),f=tt(String.prototype.trim),A=tt(RegExp.prototype.test),z=xt(TypeError);function tt(M){return function(P){for(var B=arguments.length,Z=new Array(B>1?B-1:0),pt=1;pt<B;pt++)Z[pt-1]=arguments[pt];return b(M,P,Z)}}function xt(M){return function(){for(var P=arguments.length,B=new Array(P),Z=0;Z<P;Z++)B[Z]=arguments[Z];return W(M,B)}}function R(M,P){w&&w(M,null);for(var B=P.length;B--;){var Z=P[B];if(typeof Z=="string"){var pt=bt(Z);pt!==Z&&($(P)||(P[B]=pt),Z=pt)}M[Z]=!0}return M}function V(M){var P,B=d(null);for(P in M)b(C,M,[P])&&(B[P]=M[P]);return B}function ot(M,P){for(;M!==null;){var B=F(M,P);if(B){if(B.get)return tt(B.get);if(typeof B.value=="function")return tt(B.value)}M=q(M)}function Z(pt){return console.warn("fallback value for",pt),null}return Z}var St=N(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),wt=N(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),jt=N(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ee=N(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ct=N(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),st=N(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),kt=N(["#text"]),Et=N(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Ft=N(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Vt=N(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Mt=N(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),At=i(/\{\{[\w\W]*|[\w\W]*\}\}/gm),he=i(/<%[\w\W]*|[\w\W]*%>/gm),Cn=i(/^data-[\-\w.\u00B7-\uFFFF]/),$t=i(/^aria-[\-\w]+$/),Bt=i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ze=i(/^(?:\w+script|data):/i),Sn=i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),En=i(/^html$/i),fe=function(){return typeof window>"u"?null:window},An=function(M,P){if(c(M)!=="object"||typeof M.createPolicy!="function")return null;var B=null,Z="data-tt-policy-suffix";P.currentScript&&P.currentScript.hasAttribute(Z)&&(B=P.currentScript.getAttribute(Z));var pt="dompurify"+(B?"#"+B:"");try{return M.createPolicy(pt,{createHTML:function(Nt){return Nt}})}catch{return console.warn("TrustedTypes policy "+pt+" could not be created."),null}};function Qe(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:fe(),P=function(o){return Qe(o)};if(P.version="2.3.8",P.removed=[],!M||!M.document||M.document.nodeType!==9)return P.isSupported=!1,P;var B=M.document,Z=M.document,pt=M.DocumentFragment,Nt=M.HTMLTemplateElement,Wt=M.Node,ne=M.Element,Pe=M.NodeFilter,tn=M.NamedNodeMap,Yt=tn===void 0?M.NamedNodeMap||M.MozNamedAttrMap:tn,On=M.HTMLFormElement,jn=M.DOMParser,Mn=M.trustedTypes,Ae=ne.prototype,Ln=ot(Ae,"cloneNode"),Tn=ot(Ae,"nextSibling"),In=ot(Ae,"childNodes"),Re=ot(Ae,"parentNode");if(typeof Nt=="function"){var Pt=Z.createElement("template");Pt.content&&Pt.content.ownerDocument&&(Z=Pt.content.ownerDocument)}var Rt=An(Mn,B),en=Rt?Rt.createHTML(""):"",Oe=Z,De=Oe.implementation,re=Oe.createNodeIterator,nn=Oe.createDocumentFragment,rn=Oe.getElementsByTagName,Fn=B.importNode,on={};try{on=V(Z).documentMode?Z.documentMode:{}}catch{}var Lt={};P.isSupported=typeof Re=="function"&&De&&De.createHTMLDocument!==void 0&&on!==9;var me,Gt,je=At,Me=he,Ue=Cn,$n=$t,an=Ze,Le=Sn,nt=Bt,ht=null,sn=R({},[].concat(T(St),T(wt),T(jt),T(ct),T(kt))),ft=null,oe=R({},[].concat(T(Et),T(Ft),T(Vt),T(Mt))),lt=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ie=null,Te=null,qe=!0,ze=!0,ln=!1,ae=!1,Zt=!1,He=!1,Be=!1,se=!1,Ie=!1,le=!1,cn=!0,We=!0,ce=!1,Dt={},ue=null,un=R({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),dn=null,pn=R({},["audio","video","img","source","image","track"]),Ge=null,Qt=R({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),de="http://www.w3.org/1998/Math/MathML",Ke="http://www.w3.org/2000/svg",Kt="http://www.w3.org/1999/xhtml",Fe=Kt,hn=!1,ge=["application/xhtml+xml","text/html"],ye="text/html",pe=null,Nn=Z.createElement("form"),fn=function(o){return o instanceof RegExp||o instanceof Function},Je=function(o){pe&&pe===o||(o&&c(o)==="object"||(o={}),o=V(o),ht="ALLOWED_TAGS"in o?R({},o.ALLOWED_TAGS):sn,ft="ALLOWED_ATTR"in o?R({},o.ALLOWED_ATTR):oe,Ge="ADD_URI_SAFE_ATTR"in o?R(V(Qt),o.ADD_URI_SAFE_ATTR):Qt,dn="ADD_DATA_URI_TAGS"in o?R(V(pn),o.ADD_DATA_URI_TAGS):pn,ue="FORBID_CONTENTS"in o?R({},o.FORBID_CONTENTS):un,ie="FORBID_TAGS"in o?R({},o.FORBID_TAGS):{},Te="FORBID_ATTR"in o?R({},o.FORBID_ATTR):{},Dt="USE_PROFILES"in o&&o.USE_PROFILES,qe=o.ALLOW_ARIA_ATTR!==!1,ze=o.ALLOW_DATA_ATTR!==!1,ln=o.ALLOW_UNKNOWN_PROTOCOLS||!1,ae=o.SAFE_FOR_TEMPLATES||!1,Zt=o.WHOLE_DOCUMENT||!1,se=o.RETURN_DOM||!1,Ie=o.RETURN_DOM_FRAGMENT||!1,le=o.RETURN_TRUSTED_TYPE||!1,Be=o.FORCE_BODY||!1,cn=o.SANITIZE_DOM!==!1,We=o.KEEP_CONTENT!==!1,ce=o.IN_PLACE||!1,nt=o.ALLOWED_URI_REGEXP||nt,Fe=o.NAMESPACE||Kt,o.CUSTOM_ELEMENT_HANDLING&&fn(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(lt.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&fn(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(lt.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(lt.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),me=me=ge.indexOf(o.PARSER_MEDIA_TYPE)===-1?ye:o.PARSER_MEDIA_TYPE,Gt=me==="application/xhtml+xml"?function(I){return I}:bt,ae&&(ze=!1),Ie&&(se=!0),Dt&&(ht=R({},T(kt)),ft=[],Dt.html===!0&&(R(ht,St),R(ft,Et)),Dt.svg===!0&&(R(ht,wt),R(ft,Ft),R(ft,Mt)),Dt.svgFilters===!0&&(R(ht,jt),R(ft,Ft),R(ft,Mt)),Dt.mathMl===!0&&(R(ht,ct),R(ft,Vt),R(ft,Mt))),o.ADD_TAGS&&(ht===sn&&(ht=V(ht)),R(ht,o.ADD_TAGS)),o.ADD_ATTR&&(ft===oe&&(ft=V(ft)),R(ft,o.ADD_ATTR)),o.ADD_URI_SAFE_ATTR&&R(Ge,o.ADD_URI_SAFE_ATTR),o.FORBID_CONTENTS&&(ue===un&&(ue=V(ue)),R(ue,o.FORBID_CONTENTS)),We&&(ht["#text"]=!0),Zt&&R(ht,["html","head","body"]),ht.table&&(R(ht,["tbody"]),delete ie.tbody),N&&N(o),pe=o)},mn=R({},["mi","mo","mn","ms","mtext"]),gn=R({},["foreignobject","desc","title","annotation-xml"]),Pn=R({},["title","style","font","a","script"]),Ut=R({},wt);R(Ut,jt),R(Ut,ee);var $e=R({},ct);R($e,st);var Rn=function(o){var I=Re(o);I&&I.tagName||(I={namespaceURI:Kt,tagName:"template"});var O=bt(o.tagName),rt=bt(I.tagName);return o.namespaceURI===Ke?I.namespaceURI===Kt?O==="svg":I.namespaceURI===de?O==="svg"&&(rt==="annotation-xml"||mn[rt]):!!Ut[O]:o.namespaceURI===de?I.namespaceURI===Kt?O==="math":I.namespaceURI===Ke?O==="math"&&gn[rt]:!!$e[O]:o.namespaceURI===Kt&&!(I.namespaceURI===Ke&&!gn[rt])&&!(I.namespaceURI===de&&!mn[rt])&&!$e[O]&&(Pn[O]||!Ut[O])},qt=function(o){dt(P.removed,{element:o});try{o.parentNode.removeChild(o)}catch{try{o.outerHTML=en}catch{o.remove()}}},ve=function(o,I){try{dt(P.removed,{attribute:I.getAttributeNode(o),from:I})}catch{dt(P.removed,{attribute:null,from:I})}if(I.removeAttribute(o),o==="is"&&!ft[o])if(se||Ie)try{qt(I)}catch{}else try{I.setAttribute(o,"")}catch{}},yn=function(o){var I,O;if(Be)o="<remove></remove>"+o;else{var rt=_t(o,/^[\r\n\t ]+/);O=rt&&rt[0]}me==="application/xhtml+xml"&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");var ut=Rt?Rt.createHTML(o):o;if(Fe===Kt)try{I=new jn().parseFromString(ut,me)}catch{}if(!I||!I.documentElement){I=De.createDocument(Fe,"template",null);try{I.documentElement.innerHTML=hn?"":ut}catch{}}var vt=I.body||I.documentElement;return o&&O&&vt.insertBefore(Z.createTextNode(O),vt.childNodes[0]||null),Fe===Kt?rn.call(I,Zt?"html":"body")[0]:Zt?I.documentElement:vt},vn=function(o){return re.call(o.ownerDocument||o,o,Pe.SHOW_ELEMENT|Pe.SHOW_COMMENT|Pe.SHOW_TEXT,null,!1)},Dn=function(o){return o instanceof On&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof Yt)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function")},be=function(o){return c(Wt)==="object"?o instanceof Wt:o&&c(o)==="object"&&typeof o.nodeType=="number"&&typeof o.nodeName=="string"},Ct=function(o,I,O){Lt[o]&&et(Lt[o],function(rt){rt.call(P,I,O,pe)})},we=function(o){var I;if(Ct("beforeSanitizeElements",o,null),Dn(o)||A(/[\u0080-\uFFFF]/,o.nodeName))return qt(o),!0;var O=Gt(o.nodeName);if(Ct("uponSanitizeElement",o,{tagName:O,allowedTags:ht}),o.hasChildNodes()&&!be(o.firstElementChild)&&(!be(o.content)||!be(o.content.firstElementChild))&&A(/<[/\w]/g,o.innerHTML)&&A(/<[/\w]/g,o.textContent)||O==="select"&&A(/<template/i,o.innerHTML))return qt(o),!0;if(!ht[O]||ie[O]){if(!ie[O]&&te(O)&&(lt.tagNameCheck instanceof RegExp&&A(lt.tagNameCheck,O)||lt.tagNameCheck instanceof Function&&lt.tagNameCheck(O)))return!1;if(We&&!ue[O]){var rt=Re(o)||o.parentNode,ut=In(o)||o.childNodes;if(ut&&rt)for(var vt=ut.length-1;vt>=0;--vt)rt.insertBefore(Ln(ut[vt],!0),Tn(o))}return qt(o),!0}return o instanceof ne&&!Rn(o)?(qt(o),!0):O!=="noscript"&&O!=="noembed"||!A(/<\/no(script|embed)/i,o.innerHTML)?(ae&&o.nodeType===3&&(I=o.textContent,I=yt(I,je," "),I=yt(I,Me," "),o.textContent!==I&&(dt(P.removed,{element:o.cloneNode()}),o.textContent=I)),Ct("afterSanitizeElements",o,null),!1):(qt(o),!0)},bn=function(o,I,O){if(cn&&(I==="id"||I==="name")&&(O in Z||O in Nn))return!1;if(!(ze&&!Te[I]&&A(Ue,I))){if(!(qe&&A($n,I))){if(!ft[I]||Te[I]){if(!(te(o)&&(lt.tagNameCheck instanceof RegExp&&A(lt.tagNameCheck,o)||lt.tagNameCheck instanceof Function&&lt.tagNameCheck(o))&&(lt.attributeNameCheck instanceof RegExp&&A(lt.attributeNameCheck,I)||lt.attributeNameCheck instanceof Function&&lt.attributeNameCheck(I))||I==="is"&&lt.allowCustomizedBuiltInElements&&(lt.tagNameCheck instanceof RegExp&&A(lt.tagNameCheck,O)||lt.tagNameCheck instanceof Function&&lt.tagNameCheck(O))))return!1}else if(!Ge[I]){if(!A(nt,yt(O,Le,""))){if((I!=="src"&&I!=="xlink:href"&&I!=="href"||o==="script"||Ee(O,"data:")!==0||!dn[o])&&!(ln&&!A(an,yt(O,Le,"")))){if(O)return!1}}}}}return!0},te=function(o){return o.indexOf("-")>0},_e=function(o){var I,O,rt,ut;Ct("beforeSanitizeAttributes",o,null);var vt=o.attributes;if(vt){var mt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ft};for(ut=vt.length;ut--;){var xe=I=vt[ut],Jt=xe.name,Ot=xe.namespaceURI;if(O=Jt==="value"?I.value:f(I.value),rt=Gt(Jt),mt.attrName=rt,mt.attrValue=O,mt.keepAttr=!0,mt.forceKeepAttr=void 0,Ct("uponSanitizeAttribute",o,mt),O=mt.attrValue,!mt.forceKeepAttr&&(ve(Jt,o),mt.keepAttr))if(A(/\/>/i,O))ve(Jt,o);else{ae&&(O=yt(O,je," "),O=yt(O,Me," "));var Xe=Gt(o.nodeName);if(bn(Xe,rt,O))try{Ot?o.setAttributeNS(Ot,Jt,O):o.setAttribute(Jt,O),it(P.removed)}catch{}}}Ct("afterSanitizeAttributes",o,null)}},Un=function o(I){var O,rt=vn(I);for(Ct("beforeSanitizeShadowDOM",I,null);O=rt.nextNode();)Ct("uponSanitizeShadowNode",O,null),we(O)||(O.content instanceof pt&&o(O.content),_e(O));Ct("afterSanitizeShadowDOM",I,null)};return P.sanitize=function(o,I){var O,rt,ut,vt,mt;if((hn=!o)&&(o="<!-->"),typeof o!="string"&&!be(o)){if(typeof o.toString!="function")throw z("toString is not a function");if(typeof(o=o.toString())!="string")throw z("dirty is not a string, aborting")}if(!P.isSupported){if(c(M.toStaticHTML)==="object"||typeof M.toStaticHTML=="function"){if(typeof o=="string")return M.toStaticHTML(o);if(be(o))return M.toStaticHTML(o.outerHTML)}return o}if(He||Je(I),P.removed=[],typeof o=="string"&&(ce=!1),ce){if(o.nodeName){var xe=Gt(o.nodeName);if(!ht[xe]||ie[xe])throw z("root node is forbidden and cannot be sanitized in-place")}}else if(o instanceof Wt)(rt=(O=yn("<!---->")).ownerDocument.importNode(o,!0)).nodeType===1&&rt.nodeName==="BODY"||rt.nodeName==="HTML"?O=rt:O.appendChild(rt);else{if(!se&&!ae&&!Zt&&o.indexOf("<")===-1)return Rt&&le?Rt.createHTML(o):o;if(!(O=yn(o)))return se?null:le?en:""}O&&Be&&qt(O.firstChild);for(var Jt=vn(ce?o:O);ut=Jt.nextNode();)ut.nodeType===3&&ut===vt||we(ut)||(ut.content instanceof pt&&Un(ut.content),_e(ut),vt=ut);if(vt=null,ce)return o;if(se){if(Ie)for(mt=nn.call(O.ownerDocument);O.firstChild;)mt.appendChild(O.firstChild);else mt=O;return ft.shadowroot&&(mt=Fn.call(B,mt,!0)),mt}var Ot=Zt?O.outerHTML:O.innerHTML;return Zt&&ht["!doctype"]&&O.ownerDocument&&O.ownerDocument.doctype&&O.ownerDocument.doctype.name&&A(En,O.ownerDocument.doctype.name)&&(Ot="<!DOCTYPE "+O.ownerDocument.doctype.name+`>
`+Ot),ae&&(Ot=yt(Ot,je," "),Ot=yt(Ot,Me," ")),Rt&&le?Rt.createHTML(Ot):Ot},P.setConfig=function(o){Je(o),He=!0},P.clearConfig=function(){pe=null,He=!1},P.isValidAttribute=function(o,I,O){pe||Je({});var rt=Gt(o),ut=Gt(I);return bn(rt,ut,O)},P.addHook=function(o,I){typeof I=="function"&&(Lt[o]=Lt[o]||[],dt(Lt[o],I))},P.removeHook=function(o){if(Lt[o])return it(Lt[o])},P.removeHooks=function(o){Lt[o]&&(Lt[o]=[])},P.removeAllHooks=function(){Lt={}},P}return Qe()}()},729:S=>{"use strict";var c=Object.prototype.hasOwnProperty,y="~";function _(){}function s(p,E,h){this.fn=p,this.context=E,this.once=h||!1}function T(p,E,h,C,w){if(typeof h!="function")throw new TypeError("The listener must be a function");var $=new s(h,C||p,w),q=y?y+E:E;return p._events[q]?p._events[q].fn?p._events[q]=[p._events[q],$]:p._events[q].push($):(p._events[q]=$,p._eventsCount++),p}function K(p,E){--p._eventsCount==0?p._events=new _:delete p._events[E]}function x(){this._events=new _,this._eventsCount=0}Object.create&&(_.prototype=Object.create(null),new _().__proto__||(y=!1)),x.prototype.eventNames=function(){var p,E,h=[];if(this._eventsCount===0)return h;for(E in p=this._events)c.call(p,E)&&h.push(y?E.slice(1):E);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(p)):h},x.prototype.listeners=function(p){var E=y?y+p:p,h=this._events[E];if(!h)return[];if(h.fn)return[h.fn];for(var C=0,w=h.length,$=new Array(w);C<w;C++)$[C]=h[C].fn;return $},x.prototype.listenerCount=function(p){var E=y?y+p:p,h=this._events[E];return h?h.fn?1:h.length:0},x.prototype.emit=function(p,E,h,C,w,$){var q=y?y+p:p;if(!this._events[q])return!1;var F,N,i=this._events[q],d=arguments.length;if(i.fn){switch(i.once&&this.removeListener(p,i.fn,void 0,!0),d){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,E),!0;case 3:return i.fn.call(i.context,E,h),!0;case 4:return i.fn.call(i.context,E,h,C),!0;case 5:return i.fn.call(i.context,E,h,C,w),!0;case 6:return i.fn.call(i.context,E,h,C,w,$),!0}for(N=1,F=new Array(d-1);N<d;N++)F[N-1]=arguments[N];i.fn.apply(i.context,F)}else{var v,b=i.length;for(N=0;N<b;N++)switch(i[N].once&&this.removeListener(p,i[N].fn,void 0,!0),d){case 1:i[N].fn.call(i[N].context);break;case 2:i[N].fn.call(i[N].context,E);break;case 3:i[N].fn.call(i[N].context,E,h);break;case 4:i[N].fn.call(i[N].context,E,h,C);break;default:if(!F)for(v=1,F=new Array(d-1);v<d;v++)F[v-1]=arguments[v];i[N].fn.apply(i[N].context,F)}}return!0},x.prototype.on=function(p,E,h){return T(this,p,E,h,!1)},x.prototype.once=function(p,E,h){return T(this,p,E,h,!0)},x.prototype.removeListener=function(p,E,h,C){var w=y?y+p:p;if(!this._events[w])return this;if(!E)return K(this,w),this;var $=this._events[w];if($.fn)$.fn!==E||C&&!$.once||h&&$.context!==h||K(this,w);else{for(var q=0,F=[],N=$.length;q<N;q++)($[q].fn!==E||C&&!$[q].once||h&&$[q].context!==h)&&F.push($[q]);F.length?this._events[w]=F.length===1?F[0]:F:K(this,w)}return this},x.prototype.removeAllListeners=function(p){var E;return p?(E=y?y+p:p,this._events[E]&&K(this,E)):(this._events=new _,this._eventsCount=0),this},x.prototype.off=x.prototype.removeListener,x.prototype.addListener=x.prototype.on,x.prefixed=y,x.EventEmitter=x,S.exports=x},717:S=>{typeof Object.create=="function"?S.exports=function(c,y){c.super_=y,c.prototype=Object.create(y.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}})}:S.exports=function(c,y){c.super_=y;var _=function(){};_.prototype=y.prototype,c.prototype=new _,c.prototype.constructor=c}},824:S=>{var c=1e3,y=60*c,_=60*y,s=24*_,T=7*s,K=365.25*s;function x(p,E,h,C){var w=E>=1.5*h;return Math.round(p/h)+" "+C+(w?"s":"")}S.exports=function(p,E){E=E||{};var h=typeof p;if(h==="string"&&p.length>0)return function(C){if(!((C=String(C)).length>100)){var w=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(C);if(w){var $=parseFloat(w[1]);switch((w[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return $*K;case"weeks":case"week":case"w":return $*T;case"days":case"day":case"d":return $*s;case"hours":case"hour":case"hrs":case"hr":case"h":return $*_;case"minutes":case"minute":case"mins":case"min":case"m":return $*y;case"seconds":case"second":case"secs":case"sec":case"s":return $*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return $;default:return}}}}(p);if(h==="number"&&isFinite(p))return E.long?function(C){var w=Math.abs(C);return w>=s?x(C,w,s,"day"):w>=_?x(C,w,_,"hour"):w>=y?x(C,w,y,"minute"):w>=c?x(C,w,c,"second"):C+" ms"}(p):function(C){var w=Math.abs(C);return w>=s?Math.round(C/s)+"d":w>=_?Math.round(C/_)+"h":w>=y?Math.round(C/y)+"m":w>=c?Math.round(C/c)+"s":C+"ms"}(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))}},520:(S,c,y)=>{"use strict";var _=y(155),s=_.platform==="win32",T=y(539);function K(i,d){for(var v=[],b=0;b<i.length;b++){var W=i[b];W&&W!=="."&&(W===".."?v.length&&v[v.length-1]!==".."?v.pop():d&&v.push(".."):v.push(W))}return v}function x(i){for(var d=i.length-1,v=0;v<=d&&!i[v];v++);for(var b=d;b>=0&&!i[b];b--);return v===0&&b===d?i:v>b?[]:i.slice(v,b+1)}var p=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,E=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,h={};function C(i){var d=p.exec(i),v=(d[1]||"")+(d[2]||""),b=d[3]||"",W=E.exec(b);return[v,W[1],W[2],W[3]]}function w(i){var d=p.exec(i),v=d[1]||"",b=!!v&&v[1]!==":";return{device:v,isUnc:b,isAbsolute:b||!!d[2],tail:d[3]}}function $(i){return"\\\\"+i.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}h.resolve=function(){for(var i="",d="",v=!1,b=arguments.length-1;b>=-1;b--){var W;if(b>=0?W=arguments[b]:i?(W=_.env["="+i])&&W.substr(0,3).toLowerCase()===i.toLowerCase()+"\\"||(W=i+"\\"):W=_.cwd(),!T.isString(W))throw new TypeError("Arguments to path.resolve must be strings");if(W){var et=w(W),it=et.device,dt=et.isUnc,bt=et.isAbsolute,_t=et.tail;if((!it||!i||it.toLowerCase()===i.toLowerCase())&&(i||(i=it),v||(d=_t+"\\"+d,v=bt),i&&v))break}}return dt&&(i=$(i)),i+(v?"\\":"")+(d=K(d.split(/[\\\/]+/),!v).join("\\"))||"."},h.normalize=function(i){var d=w(i),v=d.device,b=d.isUnc,W=d.isAbsolute,et=d.tail,it=/[\\\/]$/.test(et);return(et=K(et.split(/[\\\/]+/),!W).join("\\"))||W||(et="."),et&&it&&(et+="\\"),b&&(v=$(v)),v+(W?"\\":"")+et},h.isAbsolute=function(i){return w(i).isAbsolute},h.join=function(){for(var i=[],d=0;d<arguments.length;d++){var v=arguments[d];if(!T.isString(v))throw new TypeError("Arguments to path.join must be strings");v&&i.push(v)}var b=i.join("\\");return/^[\\\/]{2}[^\\\/]/.test(i[0])||(b=b.replace(/^[\\\/]{2,}/,"\\")),h.normalize(b)},h.relative=function(i,d){i=h.resolve(i),d=h.resolve(d);for(var v=i.toLowerCase(),b=d.toLowerCase(),W=x(d.split("\\")),et=x(v.split("\\")),it=x(b.split("\\")),dt=Math.min(et.length,it.length),bt=dt,_t=0;_t<dt;_t++)if(et[_t]!==it[_t]){bt=_t;break}if(bt==0)return d;var yt=[];for(_t=bt;_t<et.length;_t++)yt.push("..");return(yt=yt.concat(W.slice(bt))).join("\\")},h._makeLong=function(i){if(!T.isString(i))return i;if(!i)return"";var d=h.resolve(i);return/^[a-zA-Z]\:\\/.test(d)?"\\\\?\\"+d:/^\\\\[^?.]/.test(d)?"\\\\?\\UNC\\"+d.substring(2):i},h.dirname=function(i){var d=C(i),v=d[0],b=d[1];return v||b?(b&&(b=b.substr(0,b.length-1)),v+b):"."},h.basename=function(i,d){var v=C(i)[2];return d&&v.substr(-1*d.length)===d&&(v=v.substr(0,v.length-d.length)),v},h.extname=function(i){return C(i)[3]},h.format=function(i){if(!T.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var d=i.root||"";if(!T.isString(d))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);var v=i.dir,b=i.base||"";return v?v[v.length-1]===h.sep?v+b:v+h.sep+b:b},h.parse=function(i){if(!T.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var d=C(i);if(!d||d.length!==4)throw new TypeError("Invalid path '"+i+"'");return{root:d[0],dir:d[0]+d[1].slice(0,-1),base:d[2],ext:d[3],name:d[2].slice(0,d[2].length-d[3].length)}},h.sep="\\",h.delimiter=";";var q=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,F={};function N(i){return q.exec(i).slice(1)}F.resolve=function(){for(var i="",d=!1,v=arguments.length-1;v>=-1&&!d;v--){var b=v>=0?arguments[v]:_.cwd();if(!T.isString(b))throw new TypeError("Arguments to path.resolve must be strings");b&&(i=b+"/"+i,d=b[0]==="/")}return(d?"/":"")+(i=K(i.split("/"),!d).join("/"))||"."},F.normalize=function(i){var d=F.isAbsolute(i),v=i&&i[i.length-1]==="/";return(i=K(i.split("/"),!d).join("/"))||d||(i="."),i&&v&&(i+="/"),(d?"/":"")+i},F.isAbsolute=function(i){return i.charAt(0)==="/"},F.join=function(){for(var i="",d=0;d<arguments.length;d++){var v=arguments[d];if(!T.isString(v))throw new TypeError("Arguments to path.join must be strings");v&&(i+=i?"/"+v:v)}return F.normalize(i)},F.relative=function(i,d){i=F.resolve(i).substr(1),d=F.resolve(d).substr(1);for(var v=x(i.split("/")),b=x(d.split("/")),W=Math.min(v.length,b.length),et=W,it=0;it<W;it++)if(v[it]!==b[it]){et=it;break}var dt=[];for(it=et;it<v.length;it++)dt.push("..");return(dt=dt.concat(b.slice(et))).join("/")},F._makeLong=function(i){return i},F.dirname=function(i){var d=N(i),v=d[0],b=d[1];return v||b?(b&&(b=b.substr(0,b.length-1)),v+b):"."},F.basename=function(i,d){var v=N(i)[2];return d&&v.substr(-1*d.length)===d&&(v=v.substr(0,v.length-d.length)),v},F.extname=function(i){return N(i)[3]},F.format=function(i){if(!T.isObject(i))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof i);var d=i.root||"";if(!T.isString(d))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof i.root);return(i.dir?i.dir+F.sep:"")+(i.base||"")},F.parse=function(i){if(!T.isString(i))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof i);var d=N(i);if(!d||d.length!==4)throw new TypeError("Invalid path '"+i+"'");return d[1]=d[1]||"",d[2]=d[2]||"",d[3]=d[3]||"",{root:d[0],dir:d[0]+d[1].slice(0,-1),base:d[2],ext:d[3],name:d[2].slice(0,d[2].length-d[3].length)}},F.sep="/",F.delimiter=":",S.exports=s?h:F,S.exports.posix=F,S.exports.win32=h},155:S=>{var c,y,_=S.exports={};function s(){throw new Error("setTimeout has not been defined")}function T(){throw new Error("clearTimeout has not been defined")}function K(F){if(c===setTimeout)return setTimeout(F,0);if((c===s||!c)&&setTimeout)return c=setTimeout,setTimeout(F,0);try{return c(F,0)}catch{try{return c.call(null,F,0)}catch{return c.call(this,F,0)}}}(function(){try{c=typeof setTimeout=="function"?setTimeout:s}catch{c=s}try{y=typeof clearTimeout=="function"?clearTimeout:T}catch{y=T}})();var x,p=[],E=!1,h=-1;function C(){E&&x&&(E=!1,x.length?p=x.concat(p):h=-1,p.length&&w())}function w(){if(!E){var F=K(C);E=!0;for(var N=p.length;N;){for(x=p,p=[];++h<N;)x&&x[h].run();h=-1,N=p.length}x=null,E=!1,function(i){if(y===clearTimeout)return clearTimeout(i);if((y===T||!y)&&clearTimeout)return y=clearTimeout,clearTimeout(i);try{y(i)}catch{try{return y.call(null,i)}catch{return y.call(this,i)}}}(F)}}function $(F,N){this.fun=F,this.array=N}function q(){}_.nextTick=function(F){var N=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)N[i-1]=arguments[i];p.push(new $(F,N)),p.length!==1||E||K(w)},$.prototype.run=function(){this.fun.apply(null,this.array)},_.title="browser",_.browser=!0,_.env={},_.argv=[],_.version="",_.versions={},_.on=q,_.addListener=q,_.once=q,_.off=q,_.removeListener=q,_.removeAllListeners=q,_.emit=q,_.prependListener=q,_.prependOnceListener=q,_.listeners=function(F){return[]},_.binding=function(F){throw new Error("process.binding is not supported")},_.cwd=function(){return"/"},_.chdir=function(F){throw new Error("process.chdir is not supported")},_.umask=function(){return 0}},384:S=>{S.exports=function(c){return c&&typeof c=="object"&&typeof c.copy=="function"&&typeof c.fill=="function"&&typeof c.readUInt8=="function"}},539:(S,c,y)=>{var _=y(155),s=/%[sdj%]/g;c.format=function(f){if(!i(f)){for(var A=[],z=0;z<arguments.length;z++)A.push(x(arguments[z]));return A.join(" ")}z=1;for(var tt=arguments,xt=tt.length,R=String(f).replace(s,function(ot){if(ot==="%%")return"%";if(z>=xt)return ot;switch(ot){case"%s":return String(tt[z++]);case"%d":return Number(tt[z++]);case"%j":try{return JSON.stringify(tt[z++])}catch{return"[Circular]"}default:return ot}}),V=tt[z];z<xt;V=tt[++z])F(V)||!b(V)?R+=" "+V:R+=" "+x(V);return R},c.deprecate=function(f,A){if(d(y.g.process))return function(){return c.deprecate(f,A).apply(this,arguments)};if(_.noDeprecation===!0)return f;var z=!1;return function(){if(!z){if(_.throwDeprecation)throw new Error(A);_.traceDeprecation?console.trace(A):console.error(A),z=!0}return f.apply(this,arguments)}};var T,K={};function x(f,A){var z={seen:[],stylize:E};return arguments.length>=3&&(z.depth=arguments[2]),arguments.length>=4&&(z.colors=arguments[3]),q(A)?z.showHidden=A:A&&c._extend(z,A),d(z.showHidden)&&(z.showHidden=!1),d(z.depth)&&(z.depth=2),d(z.colors)&&(z.colors=!1),d(z.customInspect)&&(z.customInspect=!0),z.colors&&(z.stylize=p),h(z,f,z.depth)}function p(f,A){var z=x.styles[A];return z?"\x1B["+x.colors[z][0]+"m"+f+"\x1B["+x.colors[z][1]+"m":f}function E(f,A){return f}function h(f,A,z){if(f.customInspect&&A&&it(A.inspect)&&A.inspect!==c.inspect&&(!A.constructor||A.constructor.prototype!==A)){var tt=A.inspect(z,f);return i(tt)||(tt=h(f,tt,z)),tt}var xt=function(ct,st){if(d(st))return ct.stylize("undefined","undefined");if(i(st)){var kt="'"+JSON.stringify(st).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ct.stylize(kt,"string")}if(N(st))return ct.stylize(""+st,"number");if(q(st))return ct.stylize(""+st,"boolean");if(F(st))return ct.stylize("null","null")}(f,A);if(xt)return xt;var R=Object.keys(A),V=function(ct){var st={};return ct.forEach(function(kt,Et){st[kt]=!0}),st}(R);if(f.showHidden&&(R=Object.getOwnPropertyNames(A)),et(A)&&(R.indexOf("message")>=0||R.indexOf("description")>=0))return C(A);if(R.length===0){if(it(A)){var ot=A.name?": "+A.name:"";return f.stylize("[Function"+ot+"]","special")}if(v(A))return f.stylize(RegExp.prototype.toString.call(A),"regexp");if(W(A))return f.stylize(Date.prototype.toString.call(A),"date");if(et(A))return C(A)}var St,wt="",jt=!1,ee=["{","}"];return $(A)&&(jt=!0,ee=["[","]"]),it(A)&&(wt=" [Function"+(A.name?": "+A.name:"")+"]"),v(A)&&(wt=" "+RegExp.prototype.toString.call(A)),W(A)&&(wt=" "+Date.prototype.toUTCString.call(A)),et(A)&&(wt=" "+C(A)),R.length!==0||jt&&A.length!=0?z<0?v(A)?f.stylize(RegExp.prototype.toString.call(A),"regexp"):f.stylize("[Object]","special"):(f.seen.push(A),St=jt?function(ct,st,kt,Et,Ft){for(var Vt=[],Mt=0,At=st.length;Mt<At;++Mt)Ee(st,String(Mt))?Vt.push(w(ct,st,kt,Et,String(Mt),!0)):Vt.push("");return Ft.forEach(function(he){he.match(/^\d+$/)||Vt.push(w(ct,st,kt,Et,he,!0))}),Vt}(f,A,z,V,R):R.map(function(ct){return w(f,A,z,V,ct,jt)}),f.seen.pop(),function(ct,st,kt){return ct.reduce(function(Et,Ft){return Ft.indexOf(`
`)>=0,Et+Ft.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?kt[0]+(st===""?"":st+`
 `)+" "+ct.join(`,
  `)+" "+kt[1]:kt[0]+st+" "+ct.join(", ")+" "+kt[1]}(St,wt,ee)):ee[0]+wt+ee[1]}function C(f){return"["+Error.prototype.toString.call(f)+"]"}function w(f,A,z,tt,xt,R){var V,ot,St;if((St=Object.getOwnPropertyDescriptor(A,xt)||{value:A[xt]}).get?ot=St.set?f.stylize("[Getter/Setter]","special"):f.stylize("[Getter]","special"):St.set&&(ot=f.stylize("[Setter]","special")),Ee(tt,xt)||(V="["+xt+"]"),ot||(f.seen.indexOf(St.value)<0?(ot=F(z)?h(f,St.value,null):h(f,St.value,z-1)).indexOf(`
`)>-1&&(ot=R?ot.split(`
`).map(function(wt){return"  "+wt}).join(`
`).substr(2):`
`+ot.split(`
`).map(function(wt){return"   "+wt}).join(`
`)):ot=f.stylize("[Circular]","special")),d(V)){if(R&&xt.match(/^\d+$/))return ot;(V=JSON.stringify(""+xt)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(V=V.substr(1,V.length-2),V=f.stylize(V,"name")):(V=V.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),V=f.stylize(V,"string"))}return V+": "+ot}function $(f){return Array.isArray(f)}function q(f){return typeof f=="boolean"}function F(f){return f===null}function N(f){return typeof f=="number"}function i(f){return typeof f=="string"}function d(f){return f===void 0}function v(f){return b(f)&&dt(f)==="[object RegExp]"}function b(f){return typeof f=="object"&&f!==null}function W(f){return b(f)&&dt(f)==="[object Date]"}function et(f){return b(f)&&(dt(f)==="[object Error]"||f instanceof Error)}function it(f){return typeof f=="function"}function dt(f){return Object.prototype.toString.call(f)}function bt(f){return f<10?"0"+f.toString(10):f.toString(10)}c.debuglog=function(f){if(d(T)&&(T=_.env.NODE_DEBUG||""),f=f.toUpperCase(),!K[f])if(new RegExp("\\b"+f+"\\b","i").test(T)){var A=_.pid;K[f]=function(){var z=c.format.apply(c,arguments);console.error("%s %d: %s",f,A,z)}}else K[f]=function(){};return K[f]},c.inspect=x,x.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},x.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=$,c.isBoolean=q,c.isNull=F,c.isNullOrUndefined=function(f){return f==null},c.isNumber=N,c.isString=i,c.isSymbol=function(f){return typeof f=="symbol"},c.isUndefined=d,c.isRegExp=v,c.isObject=b,c.isDate=W,c.isError=et,c.isFunction=it,c.isPrimitive=function(f){return f===null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||typeof f=="symbol"||f===void 0},c.isBuffer=y(384);var _t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function yt(){var f=new Date,A=[bt(f.getHours()),bt(f.getMinutes()),bt(f.getSeconds())].join(":");return[f.getDate(),_t[f.getMonth()],A].join(" ")}function Ee(f,A){return Object.prototype.hasOwnProperty.call(f,A)}c.log=function(){console.log("%s - %s",yt(),c.format.apply(c,arguments))},c.inherits=y(717),c._extend=function(f,A){if(!A||!b(A))return f;for(var z=Object.keys(A),tt=z.length;tt--;)f[z[tt]]=A[z[tt]];return f}}},g={};function k(S){var c=g[S];if(c!==void 0)return c.exports;var y=g[S]={exports:{}};return j[S].call(y.exports,y,y.exports,k),y.exports}k.n=S=>{var c=S&&S.__esModule?()=>S.default:()=>S;return k.d(c,{a:c}),c},k.d=(S,c)=>{for(var y in c)k.o(c,y)&&!k.o(S,y)&&Object.defineProperty(S,y,{enumerable:!0,get:c[y]})},k.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),k.o=(S,c)=>Object.prototype.hasOwnProperty.call(S,c),k.r=S=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(S,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(S,"__esModule",{value:!0})};var X={};return(()=>{"use strict";k.r(X),k.d(X,{LSPluginUser:()=>Jn,setupPluginUserInstance:()=>kr});var S=k(520),c=(k(856),k(996)),y=k.n(c),_=function(){return _=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},_.apply(this,arguments)};function s(e){return e.toLowerCase()}var T=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],K=/[^A-Z0-9]+/gi;function x(e,t,n){return t instanceof RegExp?e.replace(t,n):t.reduce(function(r,a){return r.replace(a,n)},e)}function p(e,t){return t===void 0&&(t={}),function(n,r){r===void 0&&(r={});for(var a=r.splitRegexp,l=a===void 0?T:a,u=r.stripRegexp,m=u===void 0?K:u,L=r.transform,D=L===void 0?s:L,Y=r.delimiter,U=Y===void 0?" ":Y,H=x(x(n,l,"$1\0$2"),m,"\0"),G=0,J=H.length;H.charAt(G)==="\0";)G++;for(;H.charAt(J-1)==="\0";)J--;return H.slice(G,J).split("\0").map(D).join(U)}(e,_({delimiter:"."},t))}var E=k(729),h=k.n(E);function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let w=navigator.platform.toLowerCase()==="win32"?S.win32:S.posix,$=function(e,t){return t===void 0&&(t={}),p(e,_({delimiter:"_"},t))};class q extends h(){constructor(t,n){super(),C(this,"_tag",void 0),C(this,"_opts",void 0),C(this,"_logs",[]),this._tag=t,this._opts=n}write(t,n,r){var a;n!=null&&n.length&&n[n.length-1]===!0&&(r=!0,n.pop());let l=n.reduce((m,L)=>(L&&L instanceof Error?m+=`${L.message} ${L.stack}`:m+=L.toString(),m),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var u;this._logs.push([t,l]),(r||(a=this._opts)!==null&&a!==void 0&&a.console)&&((u=console)===null||u===void 0||u[t==="ERROR"?"error":"debug"](`${t}: ${l}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...t){this.write("INFO",t)}error(...t){this.write("ERROR",t)}warn(...t){this.write("WARN",t)}setTag(t){this._tag=t}toJSON(){return this._logs}}function F(e,...t){try{let n=new URL(e);if(!n.origin)throw new Error(null);let r=w.join(e.substr(n.origin.length),...t);return n.origin+r}catch{return w.join(e,...t)}}function N(e,t){let n,r,a=!1,l=m=>L=>{e&&clearTimeout(e),m(L),a=!0},u=new Promise((m,L)=>{n=l(m),r=l(L),e&&(e=setTimeout(()=>r(new Error(`[deferred timeout] ${t}`)),e))});return{created:Date.now(),setTag:m=>t=m,resolve:n,reject:r,promise:u,get settled(){return a}}}let i=new Map;window.__injectedUIEffects=i;var d=k(227),v=k.n(d);function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let W="application/x-postmate-v1+json",et=0,it={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},dt=(e,t)=>(typeof t!="string"||e.origin===t)&&!!e.data&&(typeof e.data!="object"||"postmate"in e.data)&&e.data.type===W&&!!it[e.data.postmate];class bt{constructor(t){b(this,"parent",void 0),b(this,"frame",void 0),b(this,"child",void 0),b(this,"events",{}),b(this,"childOrigin",void 0),b(this,"listener",void 0),this.parent=t.parent,this.frame=t.frame,this.child=t.child,this.childOrigin=t.childOrigin,this.listener=n=>{if(!dt(n,this.childOrigin))return!1;let{data:r,name:a}=((n||{}).data||{}).value||{};n.data.postmate==="emit"&&a in this.events&&this.events[a].forEach(l=>{l.call(this,r)})},this.parent.addEventListener("message",this.listener,!1)}get(t,...n){return new Promise((r,a)=>{let l=++et,u=m=>{m.data.uid===l&&m.data.postmate==="reply"&&(this.parent.removeEventListener("message",u,!1),m.data.error?a(m.data.error):r(m.data.value))};this.parent.addEventListener("message",u,!1),this.child.postMessage({postmate:"request",type:W,property:t,args:n,uid:l},this.childOrigin)})}call(t,n){this.child.postMessage({postmate:"call",type:W,property:t,data:n},this.childOrigin)}on(t,n){this.events[t]||(this.events[t]=[]),this.events[t].push(n)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class _t{constructor(t){b(this,"model",void 0),b(this,"parent",void 0),b(this,"parentOrigin",void 0),b(this,"child",void 0),this.model=t.model,this.parent=t.parent,this.parentOrigin=t.parentOrigin,this.child=t.child,this.child.addEventListener("message",n=>{if(!dt(n,this.parentOrigin))return;let{property:r,uid:a,data:l,args:u}=n.data;n.data.postmate!=="call"?((m,L,D)=>{let Y=typeof m[L]=="function"?m[L].apply(null,D):m[L];return Promise.resolve(Y)})(this.model,r,u).then(m=>{n.source.postMessage({property:r,postmate:"reply",type:W,uid:a,value:m},n.origin)}).catch(m=>{n.source.postMessage({property:r,postmate:"reply",type:W,uid:a,error:m},n.origin)}):r in this.model&&typeof this.model[r]=="function"&&this.model[r](l)})}emit(t,n){this.parent.postMessage({postmate:"emit",type:W,value:{name:t,data:n}},this.parentOrigin)}}class yt{constructor(t){b(this,"container",void 0),b(this,"parent",void 0),b(this,"frame",void 0),b(this,"child",void 0),b(this,"childOrigin",void 0),b(this,"url",void 0),b(this,"model",void 0),this.container=t.container,this.url=t.url,this.parent=window,this.frame=document.createElement("iframe"),t.id&&(this.frame.id=t.id),t.name&&(this.frame.name=t.name),this.frame.classList.add.apply(this.frame.classList,t.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=t.model||{}}sendHandshake(t){let n=(l=>{let u=document.createElement("a");u.href=l;let m=u.protocol.length>4?u.protocol:window.location.protocol,L=u.host.length?u.port==="80"||u.port==="443"?u.hostname:u.host:window.location.host;return u.origin||`${m}//${L}`})(t=t||this.url),r,a=0;return new Promise((l,u)=>{let m=D=>!!dt(D,n)&&(D.data.postmate==="handshake-reply"?(clearInterval(r),this.parent.removeEventListener("message",m,!1),this.childOrigin=D.origin,l(new bt(this))):u("Failed handshake"));this.parent.addEventListener("message",m,!1);let L=()=>{a++,this.child.postMessage({postmate:"handshake",type:W,model:this.model},n),a===5&&clearInterval(r)};this.frame.addEventListener("load",()=>{L(),r=setInterval(L,500)}),this.frame.src=t})}destroy(){this.frame.parentNode.removeChild(this.frame)}}b(yt,"debug",!1),b(yt,"Model",void 0);class Ee{constructor(t){b(this,"child",void 0),b(this,"model",void 0),b(this,"parent",void 0),b(this,"parentOrigin",void 0),this.child=window,this.model=t,this.parent=this.child.parent}sendHandshakeReply(){return new Promise((t,n)=>{let r=a=>{if(a.data.postmate){if(a.data.postmate==="handshake"){this.child.removeEventListener("message",r,!1),a.source.postMessage({postmate:"handshake-reply",type:W},a.origin),this.parentOrigin=a.origin;let l=a.data.model;return l&&Object.keys(l).forEach(u=>{this.model[u]=l[u]}),t(new _t(this))}return n("Handshake Reply Failed")}};this.child.addEventListener("message",r,!1)})}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let{importHTML:A,createSandboxContainer:z}=window.QSandbox||{};function tt(e,t){return e.startsWith("http")?fetch(e,t):(e=e.replace("file://",""),new Promise(async(n,r)=>{try{let a=await window.apis.doAction(["readFile",e]);n({text:()=>a})}catch(a){console.error(a),r(a)}}))}class xt extends h(){constructor(t){super(),f(this,"_pluginLocal",void 0),f(this,"_frame",void 0),f(this,"_root",void 0),f(this,"_loaded",!1),f(this,"_unmountFns",[]),this._pluginLocal=t,t._dispose(()=>{this._unmount()})}async load(){let{name:t,entry:n}=this._pluginLocal.options;if(this.loaded||!n)return;let{template:r,execScripts:a}=await A(n,{fetch:tt});this._mount(r,document.body);let l=z(t,{elementGetter:()=>{var m;return(m=this._root)===null||m===void 0?void 0:m.firstChild}}).instance.proxy;l.__shadow_mode__=!0,l.LSPluginLocal=this._pluginLocal,l.LSPluginShadow=this,l.LSPluginUser=l.logseq=new Jn(this._pluginLocal.toJSON(),this._pluginLocal.caller);let u=await a(l,!0);this._unmountFns.push(u.unmount),this._loaded=!0}_mount(t,n){let r=this._frame=document.createElement("div");r.classList.add("lsp-shadow-sandbox"),r.id=this._pluginLocal.id,this._root=r.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${t}</div>`,n.appendChild(r),this.emit("mounted")}_unmount(){for(let t of this._unmountFns)t&&t.call(null)}destroy(){var t,n;(t=this.frame)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var t;return(t=this._root)===null||t===void 0?void 0:t.firstChild}get frame(){return this._frame}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let V=v()("LSPlugin:caller"),ot="#await#response#",St="#lspmsg#",wt="#lspmsg#error#",jt=e=>`#lspmsg#${e}`;class ee extends h(){constructor(t){super(),R(this,"_pluginLocal",void 0),R(this,"_connected",!1),R(this,"_parent",void 0),R(this,"_child",void 0),R(this,"_shadow",void 0),R(this,"_status",void 0),R(this,"_userModel",{}),R(this,"_call",void 0),R(this,"_callUserModel",void 0),R(this,"_debugTag",""),this._pluginLocal=t,t&&(this._debugTag=t.debugTag)}async connectToChild(){if(this._connected)return;let{shadow:t}=this._pluginLocal;t?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(t={}){if(this._connected)return;let n=this,r=this._pluginLocal!=null,a=0,l=0,u=new Map,m=N(6e4),L=this._extendUserModel({"#lspmsg#ready#":async U=>{L[jt(U?.pid)]=({type:H,payload:G})=>{V(`[host (_call) -> *user] ${this._debugTag}`,H,G),n.emit(H,G)},await m.resolve()},"#lspmsg#beforeunload#":async U=>{let H=N(1e4);n.emit("beforeunload",Object.assign({actor:H},U)),await H.promise},"#lspmsg#settings#":async({type:U,payload:H})=>{n.emit("settings:changed",H)},[St]:async({ns:U,type:H,payload:G})=>{V(`[host (async) -> *user] ${this._debugTag} ns=${U} type=${H}`,G),U&&U.startsWith("hook")?n.emit(`${U}:${H}`,G):n.emit(H,G)},"#lspmsg#reply#":({_sync:U,result:H})=>{if(V(`[sync host -> *user] #${U}`,H),u.has(U)){let G=u.get(U);G&&(H!=null&&H.hasOwnProperty(wt)?G.reject(H[wt]):G.resolve(H),u.delete(U))}},...t});var D;if(r)return await m.promise,JSON.parse(JSON.stringify((D=this._pluginLocal)===null||D===void 0?void 0:D.toJSON()));let Y=new Ee(L).sendHandshakeReply();return this._status="pending",await Y.then(U=>{this._child=U,this._connected=!0,this._call=async(H,G={},J)=>{if(J){let Q=++l;u.set(Q,J),G._sync=Q,J.setTag(`async call #${Q}`),V(`async call #${Q}`)}return U.emit(jt(L.baseInfo.id),{type:H,payload:G}),J?.promise},this._callUserModel=async(H,G)=>{try{L[H](G)}catch{V(`[model method] #${H} not existed`)}},a=setInterval(()=>{if(u.size>100)for(let[H,G]of u)G.settled&&u.delete(H)},18e5)}).finally(()=>{this._status=void 0}),await m.promise,L.baseInfo}async call(t,n={}){var r;return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n)}async callAsync(t,n={}){var r;let a=N(1e4);return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n,a)}async callUserModel(t,...n){var r;return(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async callUserModelAsync(t,...n){var r;return t=`${ot}${t}`,(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async _setupIframeSandbox(){let t=this._pluginLocal,n=t.id,r=`${n}_lsp_main`,a=new URL(t.options.entry);a.searchParams.set("__v__",t.options.version);let l=document.querySelector(`#${r}`);l&&l.parentElement.removeChild(l);let u=document.createElement("div");u.classList.add("lsp-iframe-sandbox-container"),u.id=r,u.dataset.pid=n;try{var m;let U=(m=await this._pluginLocal._loadLayoutsData())===null||m===void 0?void 0:m.$$0;if(U){u.dataset.inited_layout="true";let{width:H,height:G,left:J,top:Q,vw:at,vh:gt}=U;J=Math.max(J,0),J=typeof at=="number"?`${Math.min(100*J/at,99)}%`:`${J}px`,Q=Math.max(Q,45),Q=typeof gt=="number"?`${Math.min(100*Q/gt,99)}%`:`${Q}px`,Object.assign(u.style,{width:H+"px",height:G+"px",left:J,top:Q})}}catch(U){console.error("[Restore Layout Error]",U)}document.body.appendChild(u);let L=new yt({id:n+"_iframe",container:u,url:a.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(t.toJSON()))}}),D,Y=L.sendHandshake();return this._status="pending",new Promise((U,H)=>{D=setTimeout(()=>{H(new Error("handshake Timeout")),L.destroy()},4e3),Y.then(G=>{this._parent=G,this._connected=!0,this.emit("connected"),G.on(jt(t.id),({type:J,payload:Q})=>{var at,gt;V("[user -> *host] ",J,Q),(at=this._pluginLocal)===null||at===void 0||at.emit(J,Q||{}),(gt=this._pluginLocal)===null||gt===void 0||gt.caller.emit(J,Q||{})}),this._call=async(...J)=>{await G.call(jt(t.id),{type:J[0],payload:Object.assign(J[1]||{},{$$pid:t.id})})},this._callUserModel=async(J,...Q)=>{if(J.startsWith(ot))return await G.get(J.replace(ot,""),...Q);G.call(J,Q?.[0])},U(null)}).catch(G=>{H(G)}).finally(()=>{clearTimeout(D)})}).catch(U=>{throw V("[iframe sandbox] error",U),U}).finally(()=>{this._status=void 0})}async _setupShadowSandbox(){let t=this._pluginLocal,n=this._shadow=new xt(t);try{this._status="pending",await n.load(),this._connected=!0,this.emit("connected"),this._call=async(r,a={},l)=>{var u;return l&&(a.actor=l),(u=this._pluginLocal)===null||u===void 0||u.emit(r,Object.assign(a,{$$pid:t.id})),l?.promise},this._callUserModel=async(...r)=>{var a;let l=r[0];(a=l)!==null&&a!==void 0&&a.startsWith(ot)&&(l=l.replace(ot,""));let u=r[1]||{},m=this._userModel[l];typeof m=="function"&&await m.call(null,u)}}catch(r){throw V("[shadow sandbox] error",r),r}finally{this._status=void 0}}_extendUserModel(t){return Object.assign(this._userModel,t)}_getSandboxIframeContainer(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxShadowContainer(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxIframeRoot(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame}_getSandboxShadowRoot(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame}set debugTag(t){this._debugTag=t}async destroy(){var t;let n=null;this._parent&&(n=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(n=this._getSandboxShadowContainer(),this._shadow.destroy()),(t=n)===null||t===void 0||t.parentNode.removeChild(n)}}function ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class st{constructor(t,n){ct(this,"ctx",void 0),ct(this,"opts",void 0),this.ctx=t,this.opts=n}get ctxId(){return this.ctx.baseInfo.id}setItem(t,n){var r;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,t,n,(r=this.opts)===null||r===void 0?void 0:r.assets]})}getItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}removeItem(t){var n;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}allKeys(){var t;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}clear(){var t;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}hasItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}}class kt{constructor(t){var n,r,a;a=void 0,(r="ctx")in(n=this)?Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[r]=a,this.ctx=t}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(t,...n){var r,a;let l=this.ensureHostScope();return t=(r=$(t))===null||r===void 0?void 0:r.toLowerCase(),(a=l.logseq.api["exper_"+t])===null||a===void 0?void 0:a.apply(l,n)}async loadScripts(...t){(t=t.map(n=>n!=null&&n.startsWith("http")?n:this.ctx.resolveResourceFullUrl(n))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...t)}registerFencedCodeRenderer(t,n){return this.ensureHostScope().logseq.api.exper_register_fenced_code_renderer(this.ctx.baseInfo.id,t,n)}registerExtensionsEnhancer(t,n){let r=this.ensureHostScope();return t==="katex"&&r.katex&&n(r.katex).catch(console.error),r.logseq.api.exper_register_extensions_enhancer(this.ctx.baseInfo.id,t,n)}ensureHostScope(){if(window===top)throw new Error("Can not access host scope!");return top}}function Et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Ft=e=>`task_callback_${e}`;class Vt{constructor(t,n,r={}){Et(this,"_client",void 0),Et(this,"_requestId",void 0),Et(this,"_requestOptions",void 0),Et(this,"_promise",void 0),Et(this,"_aborted",!1),this._client=t,this._requestId=n,this._requestOptions=r,this._promise=new Promise((m,L)=>{if(!this._requestId)return L(null);this._client.once(Ft(this._requestId),D=>{D&&D instanceof Error?L(D):m(D)})});let{success:a,fail:l,final:u}=this._requestOptions;this._promise.then(m=>{a?.(m)}).catch(m=>{l?.(m)}).finally(()=>{u?.()})}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class Mt extends E.EventEmitter{constructor(t){super(),Et(this,"_ctx",void 0),this._ctx=t,this.ctx.caller.on("#lsp#request#callback",n=>{let r=n?.requestId;r&&this.emit(Ft(r),n?.payload)})}static createRequestTask(t,n,r){return new Vt(t,n,r)}async _request(t){let n=this.ctx.baseInfo.id,{success:r,fail:a,final:l,...u}=t,m=this.ctx.Experiments.invokeExperMethod("request",n,u),L=Mt.createRequestTask(this.ctx.Request,m,t);return u.abortable?L:L.promise}get ctx(){return this._ctx}}let At=Array.isArray,he=typeof global=="object"&&global&&global.Object===Object&&global;var Cn=typeof self=="object"&&self&&self.Object===Object&&self;let $t=he||Cn||Function("return this")(),Bt=$t.Symbol;var Ze=Object.prototype,Sn=Ze.hasOwnProperty,En=Ze.toString,fe=Bt?Bt.toStringTag:void 0;let An=function(e){var t=Sn.call(e,fe),n=e[fe];try{e[fe]=void 0;var r=!0}catch{}var a=En.call(e);return r&&(t?e[fe]=n:delete e[fe]),a};var Qe=Object.prototype.toString;let M=function(e){return Qe.call(e)};var P=Bt?Bt.toStringTag:void 0;let B=function(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":P&&P in Object(e)?An(e):M(e)},Z=function(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")},pt=function(e){if(!Z(e))return!1;var t=B(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},Nt=$t["__core-js_shared__"];var Wt,ne=(Wt=/[^.]+$/.exec(Nt&&Nt.keys&&Nt.keys.IE_PROTO||""))?"Symbol(src)_1."+Wt:"";let Pe=function(e){return!!ne&&ne in e};var tn=Function.prototype.toString;let Yt=function(e){if(e!=null){try{return tn.call(e)}catch{}try{return e+""}catch{}}return""};var On=/^\[object .+?Constructor\]$/,jn=Function.prototype,Mn=Object.prototype,Ae=jn.toString,Ln=Mn.hasOwnProperty,Tn=RegExp("^"+Ae.call(Ln).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");let In=function(e){return!(!Z(e)||Pe(e))&&(pt(e)?Tn:On).test(Yt(e))},Re=function(e,t){return e?.[t]},Pt=function(e,t){var n=Re(e,t);return In(n)?n:void 0},Rt=function(){try{var e=Pt(Object,"defineProperty");return e({},"",{}),e}catch{}}(),en=function(e,t,n){t=="__proto__"&&Rt?Rt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},Oe=function(e){return function(t,n,r){for(var a=-1,l=Object(t),u=r(t),m=u.length;m--;){var L=u[e?m:++a];if(n(l[L],L,l)===!1)break}return t}}(),De=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},re=function(e){return e!=null&&typeof e=="object"},nn=function(e){return re(e)&&B(e)=="[object Arguments]"};var rn=Object.prototype,Fn=rn.hasOwnProperty,on=rn.propertyIsEnumerable;let Lt=nn(function(){return arguments}())?nn:function(e){return re(e)&&Fn.call(e,"callee")&&!on.call(e,"callee")},me=function(){return!1};var Gt=typeof It=="object"&&It&&!It.nodeType&&It,je=Gt&&typeof Ht=="object"&&Ht&&!Ht.nodeType&&Ht,Me=je&&je.exports===Gt?$t.Buffer:void 0;let Ue=(Me?Me.isBuffer:void 0)||me;var $n=/^(?:0|[1-9]\d*)$/;let an=function(e,t){var n=typeof e;return!!(t=t??9007199254740991)&&(n=="number"||n!="symbol"&&$n.test(e))&&e>-1&&e%1==0&&e<t},Le=function(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991};var nt={};nt["[object Float32Array]"]=nt["[object Float64Array]"]=nt["[object Int8Array]"]=nt["[object Int16Array]"]=nt["[object Int32Array]"]=nt["[object Uint8Array]"]=nt["[object Uint8ClampedArray]"]=nt["[object Uint16Array]"]=nt["[object Uint32Array]"]=!0,nt["[object Arguments]"]=nt["[object Array]"]=nt["[object ArrayBuffer]"]=nt["[object Boolean]"]=nt["[object DataView]"]=nt["[object Date]"]=nt["[object Error]"]=nt["[object Function]"]=nt["[object Map]"]=nt["[object Number]"]=nt["[object Object]"]=nt["[object RegExp]"]=nt["[object Set]"]=nt["[object String]"]=nt["[object WeakMap]"]=!1;let ht=function(e){return re(e)&&Le(e.length)&&!!nt[B(e)]},sn=function(e){return function(t){return e(t)}};var ft=typeof It=="object"&&It&&!It.nodeType&&It,oe=ft&&typeof Ht=="object"&&Ht&&!Ht.nodeType&&Ht,lt=oe&&oe.exports===ft&&he.process,ie=function(){try{var e=oe&&oe.require&&oe.require("util").types;return e||lt&&lt.binding&&lt.binding("util")}catch{}}(),Te=ie&&ie.isTypedArray;let qe=Te?sn(Te):ht;var ze=Object.prototype.hasOwnProperty;let ln=function(e,t){var n=At(e),r=!n&&Lt(e),a=!n&&!r&&Ue(e),l=!n&&!r&&!a&&qe(e),u=n||r||a||l,m=u?De(e.length,String):[],L=m.length;for(var D in e)!t&&!ze.call(e,D)||u&&(D=="length"||a&&(D=="offset"||D=="parent")||l&&(D=="buffer"||D=="byteLength"||D=="byteOffset")||an(D,L))||m.push(D);return m};var ae=Object.prototype;let Zt=function(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||ae)},He=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object);var Be=Object.prototype.hasOwnProperty;let se=function(e){if(!Zt(e))return He(e);var t=[];for(var n in Object(e))Be.call(e,n)&&n!="constructor"&&t.push(n);return t},Ie=function(e){return e!=null&&Le(e.length)&&!pt(e)},le=function(e){return Ie(e)?ln(e):se(e)},cn=function(e,t){return e&&Oe(e,t,le)},We=function(){this.__data__=[],this.size=0},ce=function(e,t){return e===t||e!=e&&t!=t},Dt=function(e,t){for(var n=e.length;n--;)if(ce(e[n][0],t))return n;return-1};var ue=Array.prototype.splice;let un=function(e){var t=this.__data__,n=Dt(t,e);return!(n<0)&&(n==t.length-1?t.pop():ue.call(t,n,1),--this.size,!0)},dn=function(e){var t=this.__data__,n=Dt(t,e);return n<0?void 0:t[n][1]},pn=function(e){return Dt(this.__data__,e)>-1},Ge=function(e,t){var n=this.__data__,r=Dt(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Qt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Qt.prototype.clear=We,Qt.prototype.delete=un,Qt.prototype.get=dn,Qt.prototype.has=pn,Qt.prototype.set=Ge;let de=Qt,Ke=function(){this.__data__=new de,this.size=0},Kt=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Fe=function(e){return this.__data__.get(e)},hn=function(e){return this.__data__.has(e)},ge=Pt($t,"Map"),ye=Pt(Object,"create"),pe=function(){this.__data__=ye?ye(null):{},this.size=0},Nn=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var fn=Object.prototype.hasOwnProperty;let Je=function(e){var t=this.__data__;if(ye){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return fn.call(t,e)?t[e]:void 0};var mn=Object.prototype.hasOwnProperty;let gn=function(e){var t=this.__data__;return ye?t[e]!==void 0:mn.call(t,e)},Pn=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ye&&t===void 0?"__lodash_hash_undefined__":t,this};function Ut(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ut.prototype.clear=pe,Ut.prototype.delete=Nn,Ut.prototype.get=Je,Ut.prototype.has=gn,Ut.prototype.set=Pn;let $e=Ut,Rn=function(){this.size=0,this.__data__={hash:new $e,map:new(ge||de),string:new $e}},qt=function(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null},ve=function(e,t){var n=e.__data__;return qt(t)?n[typeof t=="string"?"string":"hash"]:n.map},yn=function(e){var t=ve(this,e).delete(e);return this.size-=t?1:0,t},vn=function(e){return ve(this,e).get(e)},Dn=function(e){return ve(this,e).has(e)},be=function(e,t){var n=ve(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function Ct(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ct.prototype.clear=Rn,Ct.prototype.delete=yn,Ct.prototype.get=vn,Ct.prototype.has=Dn,Ct.prototype.set=be;let we=Ct,bn=function(e,t){var n=this.__data__;if(n instanceof de){var r=n.__data__;if(!ge||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new we(r)}return n.set(e,t),this.size=n.size,this};function te(e){var t=this.__data__=new de(e);this.size=t.size}te.prototype.clear=Ke,te.prototype.delete=Kt,te.prototype.get=Fe,te.prototype.has=hn,te.prototype.set=bn;let _e=te,Un=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},o=function(e){return this.__data__.has(e)};function I(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new we;++t<n;)this.add(e[t])}I.prototype.add=I.prototype.push=Un,I.prototype.has=o;let O=I,rt=function(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},ut=function(e,t){return e.has(t)},vt=function(e,t,n,r,a,l){var u=1&n,m=e.length,L=t.length;if(m!=L&&!(u&&L>m))return!1;var D=l.get(e),Y=l.get(t);if(D&&Y)return D==t&&Y==e;var U=-1,H=!0,G=2&n?new O:void 0;for(l.set(e,t),l.set(t,e);++U<m;){var J=e[U],Q=t[U];if(r)var at=u?r(Q,J,U,t,e,l):r(J,Q,U,e,t,l);if(at!==void 0){if(at)continue;H=!1;break}if(G){if(!rt(t,function(gt,Tt){if(!ut(G,Tt)&&(J===gt||a(J,gt,n,r,l)))return G.push(Tt)})){H=!1;break}}else if(J!==Q&&!a(J,Q,n,r,l)){H=!1;break}}return l.delete(e),l.delete(t),H},mt=$t.Uint8Array,xe=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r,a){n[++t]=[a,r]}),n},Jt=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n};var Ot=Bt?Bt.prototype:void 0,Xe=Ot?Ot.valueOf:void 0;let Qn=function(e,t,n,r,a,l,u){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!l(new mt(e),new mt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ce(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var m=xe;case"[object Set]":var L=1&r;if(m||(m=Jt),e.size!=t.size&&!L)return!1;var D=u.get(e);if(D)return D==t;r|=2,u.set(e,t);var Y=vt(m(e),m(t),r,a,l,u);return u.delete(e),Y;case"[object Symbol]":if(Xe)return Xe.call(e)==Xe.call(t)}return!1},Dr=function(e,t){for(var n=-1,r=t.length,a=e.length;++n<r;)e[a+n]=t[n];return e},Ur=function(e,t,n){var r=t(e);return At(e)?r:Dr(r,n(e))},qr=function(e,t){for(var n=-1,r=e==null?0:e.length,a=0,l=[];++n<r;){var u=e[n];t(u,n,e)&&(l[a++]=u)}return l},zr=function(){return[]};var Hr=Object.prototype.propertyIsEnumerable,tr=Object.getOwnPropertySymbols;let Br=tr?function(e){return e==null?[]:(e=Object(e),qr(tr(e),function(t){return Hr.call(e,t)}))}:zr,er=function(e){return Ur(e,le,Br)};var Wr=Object.prototype.hasOwnProperty;let Gr=function(e,t,n,r,a,l){var u=1&n,m=er(e),L=m.length;if(L!=er(t).length&&!u)return!1;for(var D=L;D--;){var Y=m[D];if(!(u?Y in t:Wr.call(t,Y)))return!1}var U=l.get(e),H=l.get(t);if(U&&H)return U==t&&H==e;var G=!0;l.set(e,t),l.set(t,e);for(var J=u;++D<L;){var Q=e[Y=m[D]],at=t[Y];if(r)var gt=u?r(at,Q,Y,t,e,l):r(Q,at,Y,e,t,l);if(!(gt===void 0?Q===at||a(Q,at,n,r,l):gt)){G=!1;break}J||(J=Y=="constructor")}if(G&&!J){var Tt=e.constructor,Ce=t.constructor;Tt==Ce||!("constructor"in e)||!("constructor"in t)||typeof Tt=="function"&&Tt instanceof Tt&&typeof Ce=="function"&&Ce instanceof Ce||(G=!1)}return l.delete(e),l.delete(t),G},qn=Pt($t,"DataView"),zn=Pt($t,"Promise"),Hn=Pt($t,"Set"),Bn=Pt($t,"WeakMap");var nr="[object Map]",rr="[object Promise]",or="[object Set]",ir="[object WeakMap]",ar="[object DataView]",Kr=Yt(qn),Jr=Yt(ge),Xr=Yt(zn),Vr=Yt(Hn),Yr=Yt(Bn),ke=B;(qn&&ke(new qn(new ArrayBuffer(1)))!=ar||ge&&ke(new ge)!=nr||zn&&ke(zn.resolve())!=rr||Hn&&ke(new Hn)!=or||Bn&&ke(new Bn)!=ir)&&(ke=function(e){var t=B(e),n=t=="[object Object]"?e.constructor:void 0,r=n?Yt(n):"";if(r)switch(r){case Kr:return ar;case Jr:return nr;case Xr:return rr;case Vr:return or;case Yr:return ir}return t});let sr=ke;var lr="[object Arguments]",cr="[object Array]",wn="[object Object]",ur=Object.prototype.hasOwnProperty;let Zr=function(e,t,n,r,a,l){var u=At(e),m=At(t),L=u?cr:sr(e),D=m?cr:sr(t),Y=(L=L==lr?wn:L)==wn,U=(D=D==lr?wn:D)==wn,H=L==D;if(H&&Ue(e)){if(!Ue(t))return!1;u=!0,Y=!1}if(H&&!Y)return l||(l=new _e),u||qe(e)?vt(e,t,n,r,a,l):Qn(e,t,L,n,r,a,l);if(!(1&n)){var G=Y&&ur.call(e,"__wrapped__"),J=U&&ur.call(t,"__wrapped__");if(G||J){var Q=G?e.value():e,at=J?t.value():t;return l||(l=new _e),a(Q,at,n,r,l)}}return!!H&&(l||(l=new _e),Gr(e,t,n,r,a,l))},dr=function e(t,n,r,a,l){return t===n||(t==null||n==null||!re(t)&&!re(n)?t!=t&&n!=n:Zr(t,n,r,a,e,l))},Qr=function(e,t,n,r){var a=n.length,l=a,u=!r;if(e==null)return!l;for(e=Object(e);a--;){var m=n[a];if(u&&m[2]?m[1]!==e[m[0]]:!(m[0]in e))return!1}for(;++a<l;){var L=(m=n[a])[0],D=e[L],Y=m[1];if(u&&m[2]){if(D===void 0&&!(L in e))return!1}else{var U=new _e;if(r)var H=r(D,Y,L,e,t,U);if(!(H===void 0?dr(Y,D,3,r,U):H))return!1}}return!0},pr=function(e){return e==e&&!Z(e)},to=function(e){for(var t=le(e),n=t.length;n--;){var r=t[n],a=e[r];t[n]=[r,a,pr(a)]}return t},hr=function(e,t){return function(n){return n!=null&&n[e]===t&&(t!==void 0||e in Object(n))}},eo=function(e){var t=to(e);return t.length==1&&t[0][2]?hr(t[0][0],t[0][1]):function(n){return n===e||Qr(n,e,t)}},Wn=function(e){return typeof e=="symbol"||re(e)&&B(e)=="[object Symbol]"};var no=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ro=/^\w*$/;let Gn=function(e,t){if(At(e))return!1;var n=typeof e;return!(n!="number"&&n!="symbol"&&n!="boolean"&&e!=null&&!Wn(e))||ro.test(e)||!no.test(e)||t!=null&&e in Object(t)};function Kn(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var n=function(){var r=arguments,a=t?t.apply(this,r):r[0],l=n.cache;if(l.has(a))return l.get(a);var u=e.apply(this,r);return n.cache=l.set(a,u)||l,u};return n.cache=new(Kn.Cache||we),n}Kn.Cache=we;let oo=Kn;var io=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ao=/\\(\\)?/g;let so=function(e){var t=oo(e,function(r){return n.size===500&&n.clear(),r}),n=t.cache;return t}(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(io,function(n,r,a,l){t.push(a?l.replace(ao,"$1"):r||n)}),t}),lo=function(e,t){for(var n=-1,r=e==null?0:e.length,a=Array(r);++n<r;)a[n]=t(e[n],n,e);return a};var fr=Bt?Bt.prototype:void 0,mr=fr?fr.toString:void 0;let co=function e(t){if(typeof t=="string")return t;if(At(t))return lo(t,e)+"";if(Wn(t))return mr?mr.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n},uo=function(e){return e==null?"":co(e)},gr=function(e,t){return At(e)?e:Gn(e,t)?[e]:so(uo(e))},_n=function(e){if(typeof e=="string"||Wn(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t},yr=function(e,t){for(var n=0,r=(t=gr(t,e)).length;e!=null&&n<r;)e=e[_n(t[n++])];return n&&n==r?e:void 0},po=function(e,t,n){var r=e==null?void 0:yr(e,t);return r===void 0?n:r},ho=function(e,t){return e!=null&&t in Object(e)},fo=function(e,t,n){for(var r=-1,a=(t=gr(t,e)).length,l=!1;++r<a;){var u=_n(t[r]);if(!(l=e!=null&&n(e,u)))break;e=e[u]}return l||++r!=a?l:!!(a=e==null?0:e.length)&&Le(a)&&an(u,a)&&(At(e)||Lt(e))},mo=function(e,t){return e!=null&&fo(e,t,ho)},go=function(e,t){return Gn(e)&&pr(t)?hr(_n(e),t):function(n){var r=po(n,e);return r===void 0&&r===t?mo(n,e):dr(t,r,3)}},yo=function(e){return e},vo=function(e){return function(t){return t?.[e]}},bo=function(e){return function(t){return yr(t,e)}},wo=function(e){return Gn(e)?vo(_n(e)):bo(e)},_o=function(e){return typeof e=="function"?e:e==null?yo:typeof e=="object"?At(e)?go(e[0],e[1]):eo(e):wo(e)},xo=function(e,t){var n={};return t=_o(t,3),cn(e,function(r,a,l){en(n,t(r,a,l),r)}),n};function vr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ko{constructor(t,n){vr(this,"ctx",void 0),vr(this,"serviceHooks",void 0),this.ctx=t,this.serviceHooks=n,t._execCallableAPI("register-search-service",t.baseInfo.id,n.name,n.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:r=>(At(r?.blocks)&&(r.blocks=r.blocks.map(a=>a&&xo(a,(l,u)=>`block/${u}`))),r)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach(([r,a])=>{let l=(u=>`service:search:${u}:${n.name}`)(r);t.caller.on(l,async u=>{if(pt(n?.[a.f])){let m=null;try{m=await n[a.f].apply(n,(a.args||[]).map(L=>{if(u){if(L===!0)return u;if(u.hasOwnProperty(L)){let D=u[L];return delete u[L],D}}})),a.transformOutput&&(m=a.transformOutput(m))}catch(L){console.error("[SearchService] ",L),m=L}finally{a.reply&&t.caller.call(`${l}:reply`,m)}}})})}}function zt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let Co=Symbol.for("proxy-continue"),So=v()("LSPlugin:user"),br=new q("",{console:!0});function Ne(e,t,n){var r;let{key:a,label:l,desc:u,palette:m,keybinding:L,extras:D}=t;if(typeof n!="function")return this.logger.error(`${a||l}: command action should be function.`),!1;let Y=function(H){if(typeof H=="string")return H.trim().replace(/\s/g,"_").toLowerCase()}(a);if(!Y)return this.logger.error(`${l}: command key is required.`),!1;let U=`SimpleCommandHook${Y}${++xr}`;this.Editor["on"+U](n),(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:Y,label:l,type:e,desc:u,keybinding:L,extras:D},["editor/hook",U]],m]})}function wr(e){return!(typeof(t=e)!="string"||t.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t))||(br.error(`#${e} is not a valid UUID string.`),!1);var t}let xn=null,_r=new Map,Eo={async getInfo(e){return xn||(xn=await this._execCallableAPIAsync("get-app-info")),typeof e=="string"?xn[e]:xn},registerCommand:Ne,registerSearchService(e){if(_r.has(e.name))throw new Error(`SearchService: #${e.name} has registered!`);_r.set(e.name,new ko(this,e))},registerCommandPalette(e,t){let{key:n,label:r,keybinding:a}=e;return Ne.call(this,"$palette$",{key:n,label:r,palette:!0,keybinding:a},t)},registerCommandShortcut(e,t,n={}){typeof e=="string"&&(e={mode:"global",binding:e});let{binding:r}=e,a="$shortcut$",l=n.key||a+$(r?.toString());return Ne.call(this,a,{...n,key:l,palette:!1,keybinding:e},t)},registerUIItem(e,t){var n;let r=this.baseInfo.id;(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-ui-item",args:[r,e,t]})},registerPageMenuItem(e,t){if(typeof t!="function")return!1;let n=e+"_"+this.baseInfo.id,r=e;Ne.call(this,"page-menu-item",{key:n,label:r},t)},onBlockRendererSlotted(e,t){if(!wr(e))return;let n=this.baseInfo.id,r=`hook:editor:${$(`slot:${e}`)}`;return this.caller.on(r,t),this.App._installPluginHook(n,r),()=>{this.caller.off(r,t),this.App._uninstallPluginHook(n,r)}},invokeExternalPlugin(e,...t){var n;if(!(e=(n=e)===null||n===void 0?void 0:n.trim()))return;let[r,a]=e.split(".");if(!["models","commands"].includes(a?.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");let l=e.replace(`${r}.${a}.`,"");if(!r||!a||!l)throw new Error(`Illegal type of #${e} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",r,a.toLowerCase(),l,t)},setFullScreen(e){let t=(...n)=>this._callWin("setFullScreen",...n);e==="toggle"?this._callWin("isFullScreen").then(n=>{n?t():t(!0)}):e?t(!0):t()}},xr=0,Ao={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},registerSlashCommand(e,t){var n;So("Register slash command #",this.baseInfo.id,e,t),typeof t=="function"&&(t=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",t]]),t=t.map(r=>{let[a,...l]=r;if(a==="editor/hook"){let u=l[0],m=()=>{var D;(D=this.caller)===null||D===void 0||D.callUserModel(u)};typeof u=="function"&&(m=u);let L=`SlashCommandHook${a}${++xr}`;r[1]=L,this.Editor["on"+L](m)}return r}),(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[e,t]]})},registerBlockContextMenuItem(e,t){if(typeof t!="function")return!1;let n=e+"_"+this.baseInfo.id;Ne.call(this,"block-context-menu-item",{key:n,label:e},t)},registerHighlightContextMenuItem(e,t,n){if(typeof t!="function")return!1;let r=e+"_"+this.baseInfo.id;Ne.call(this,"highlight-context-menu-item",{key:r,label:e,extras:n},t)},scrollToBlockInPage(e,t,n){let r="block-content-"+t;n!=null&&n.replaceState?this.App.replaceState("page",{name:e},{anchor:r}):this.App.pushState("page",{name:e},{anchor:r})}},Oo={onBlockChanged(e,t){if(!wr(e))return;let n=this.baseInfo.id,r=`hook:db:${$(`block:${e}`)}`,a=({block:l,txData:u,txMeta:m})=>{l.uuid===e&&t(l,u,m)};return this.caller.on(r,a),this.App._installPluginHook(n,r),()=>{this.caller.off(r,a),this.App._uninstallPluginHook(n,r)}},datascriptQuery(e,...t){return t.pop(),t!=null&&t.some(n=>typeof n=="function")?this.Experiments.ensureHostScope().logseq.api.datascript_query(e,...t):this._execCallableAPIAsync("datascript_query",e,...t)}},jo={},Mo={},Lo={makeSandboxStorage(){return new st(this,{assets:!0})}};class Jn extends h(){constructor(t,n){super(),zt(this,"_baseInfo",void 0),zt(this,"_caller",void 0),zt(this,"_version","0.0.17"),zt(this,"_debugTag",""),zt(this,"_settingsSchema",void 0),zt(this,"_connected",!1),zt(this,"_ui",new Map),zt(this,"_mFileStorage",void 0),zt(this,"_mRequest",void 0),zt(this,"_mExperiments",void 0),zt(this,"_beforeunloadCallback",void 0),this._baseInfo=t,this._caller=n,n.on("sys:ui:visible",r=>{r!=null&&r.toggle&&this.toggleMainUI()}),n.on("settings:changed",r=>{let a=Object.assign({},this.settings),l=Object.assign(this._baseInfo.settings,r);this.emit("settings:changed",{...l},a)}),n.on("beforeunload",async r=>{let{actor:a,...l}=r,u=this._beforeunloadCallback;try{u&&await u(l),a?.resolve(null)}catch(m){this.logger.error("[beforeunload] ",m),a?.reject(m)}})}async ready(t,n){var r,a;if(!this._connected)try{var l;typeof t=="function"&&(n=t,t={});let u=await this._caller.connectToParent(t);this._connected=!0,r=this._baseInfo,a=u,u=y()(r,a,{arrayMerge:(m,L)=>L}),this._baseInfo=u,(l=u)!==null&&l!==void 0&&l.id&&(this._debugTag=this._caller.debugTag=`#${u.id} [${u.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(u.settings=function(m,L){let D=(L||[]).reduce((Y,U)=>("default"in U&&(Y[U.key]=U.default),Y),{});return Object.assign(D,m)}(u.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version})}catch(m){console.warn(m)}n&&n.call(this,u)}catch(u){console.error(`${this._debugTag} [Ready Error]`,u)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(t){typeof t=="function"&&(this._beforeunloadCallback=t)}provideModel(t){return this.caller._extendUserModel(t),this}provideTheme(t){return this.caller.call("provider:theme",t),this}provideStyle(t){return this.caller.call("provider:style",t),this}provideUI(t){return this.caller.call("provider:ui",t),this}useSettingsSchema(t){return this.connected&&this.caller.call("settings:schema",{schema:t,isSync:!0}),this._settingsSchema=t,this}updateSettings(t){this.caller.call("settings:update",t)}onSettingsChanged(t){let n="settings:changed";return this.on(n,t),()=>this.off(n,t)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(t){this.caller.call("main-ui:attrs",t)}setMainUIInlineStyle(t){this.caller.call("main-ui:style",t)}hideMainUI(t){let n={key:0,visible:!1,cursor:t?.restoreEditingCursor};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}showMainUI(t){let n={key:0,visible:!0,autoFocus:t?.autoFocus};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}toggleMainUI(){let n=this._ui.get(0);n&&n.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){let t=this._ui.get(0);return!!(t&&t.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(t=this)&&(((n=t.baseInfo)===null||n===void 0?void 0:n.effect)||!((r=t.baseInfo)!==null&&r!==void 0&&r.iir));var t,n,r}get logger(){return br}get settings(){var t;return(t=this.baseInfo)===null||t===void 0?void 0:t.settings}get caller(){return this._caller}resolveResourceFullUrl(t){if(this.ensureConnected(),t)return t=t.replace(/^[.\\/]+/,""),F(this._baseInfo.lsr,t)}_makeUserProxy(t,n){let r=this,a=this.caller;return new Proxy(t,{get(l,u,m){let L=l[u];return function(...D){if(L){let U=L.apply(r,D.concat(n));if(U!==Co)return U}if(n){let U=u.toString().match(/^(once|off|on)/i);if(U!=null){let H=U[0].toLowerCase(),G=U.input,J=H==="off",Q=r.baseInfo.id,at=G.slice(H.length),gt=D[0],Tt=D[1];typeof gt=="string"&&typeof Tt=="function"&&(gt=gt.replace(/^logseq./,":"),at=`${at}${gt}`,gt=Tt,Tt=D[2]),at=`hook:${n}:${$(at)}`,a[H](at,gt);let Ce=()=>{a.off(at,gt),a.listenerCount(at)||r.App._uninstallPluginHook(Q,at)};return J?void Ce():(r.App._installPluginHook(Q,at,Tt),Ce)}}let Y=u;return["git","ui","assets"].includes(n)&&(Y=n+"_"+Y),a.callAsync("api:call",{tag:n,method:Y,args:D})}}})}_execCallableAPIAsync(t,...n){return this._caller.callAsync("api:call",{method:t,args:n})}_execCallableAPI(t,...n){this._caller.call("api:call",{method:t,args:n})}_callWin(...t){return this._execCallableAPIAsync("_callMainWin",...t)}get App(){return this._makeUserProxy(Eo,"app")}get Editor(){return this._makeUserProxy(Ao,"editor")}get DB(){return this._makeUserProxy(Oo,"db")}get Git(){return this._makeUserProxy(jo,"git")}get UI(){return this._makeUserProxy(Mo,"ui")}get Assets(){return this._makeUserProxy(Lo,"assets")}get FileStorage(){let t=this._mFileStorage;return t||(t=this._mFileStorage=new st(this)),t}get Request(){let t=this._mRequest;return t||(t=this._mRequest=new Mt(this)),t}get Experiments(){let t=this._mExperiments;return t||(t=this._mExperiments=new kt(this)),t}}function kr(e,t){return new Jn(e,t)}if(window.__LSP__HOST__==null){let e=new ee(null);window.logseq=kr({},e)}})(),X})())});var Fr=Sr(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});var Do=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),Xn={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},Mr={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:Do?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},Vn={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(Ve=1;Ve<20;Ve++)Vn["f"+Ve]=111+Ve;var Ve;function kn(j,g,k){g&&!("byKey"in g)&&(k=g,g=null),Array.isArray(j)||(j=[j]);var X=j.map(function(y){return Lr(y,g)}),S=function(_){return X.some(function(s){return Tr(s,_)})},c=k==null?S:S(k);return c}function Uo(j,g){return kn(j,g)}function qo(j,g){return kn(j,{byKey:!0},g)}function Lr(j,g){var k=g&&g.byKey,X={};j=j.replace("++","+add");var S=j.split("+"),c=S.length;for(var y in Xn)X[Xn[y]]=!1;var _=!0,s=!1,T=void 0;try{for(var K=S[Symbol.iterator](),x;!(_=(x=K.next()).done);_=!0){var p=x.value,E=p.endsWith("?")&&p.length>1;E&&(p=p.slice(0,-1));var h=Yn(p),C=Xn[h];if(p.length>1&&!C&&!Mr[p]&&!Vn[h])throw new TypeError('Unknown modifier: "'+p+'"');(c===1||!C)&&(k?X.key=h:X.which=Ir(p)),C&&(X[C]=E?null:!0)}}catch(w){s=!0,T=w}finally{try{!_&&K.return&&K.return()}finally{if(s)throw T}}return X}function Tr(j,g){for(var k in j){var X=j[k],S=void 0;if(X!=null&&(k==="key"&&g.key!=null?S=g.key.toLowerCase():k==="which"?S=X===91&&g.which===93?91:g.which:S=g[k],!(S==null&&X===!1)&&S!==X))return!1}return!0}function Ir(j){j=Yn(j);var g=Vn[j]||j.toUpperCase().charCodeAt(0);return g}function Yn(j){return j=j.toLowerCase(),j=Mr[j]||j,j}Xt.default=kn;Xt.isHotkey=kn;Xt.isCodeHotkey=Uo;Xt.isKeyHotkey=qo;Xt.parseHotkey=Lr;Xt.compareHotkey=Tr;Xt.toKeyCode=Ir;Xt.toKeyName=Yn});var Yo=Er(Ar(),1);var Or=`#logseq-live-math--popup-screen {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

div[data-ref='logseq-live-math'] {
  & .ls-ui-float-content,
  .draggable-handle {
    background-color: var(--ls-secondary-background-color, var(--rx-gray-02));
  }

  & .actions {
    display: flex;
    align-items: center;
    justify-content: space-around;
    margin: 5px 0;

    & button {
      font-family: tabler-icons, ui-font, system-ui;
      font-weight: bold;
      font-size: small;

      &.clear-button {
        color: var(--ls-error-color, var(--rx-red-10));
      }
      &.reset-button {
        color: var(--ls-warning-color, var(--rx-orange-10));
      }
      &.confirm-button {
        color: var(--ls-success-color, var(--rx-green-10));
      }
      &:disabled {
        color: var(--ls-secondary-text-color, var(--rx-gray-11));
      }
    }
  }

  & math-field {
    outline: none;
    margin: 0px 5px;
    border-radius: 0;
    color: var(--ls-primary-text-color, hsl(var(--primary)));
    background-color: var(--ls-secondary-background-color, var(--rx-gray-02));
    --contains-highlight-background-color: var(--ls-block-highlight-color);
    --selection-background-color: var(--ls-selection-background-color, var(--rx-blue-10));
    --primary: var(--ls-primary-theme-color, var(--ls-wb-text-color-blue));
    --text-font-family: KaTeX_Main, 'Times New Roman', serif;
    --ui-menu-bg: var(--ls-secondary-background-color, var(--rx-gray-02));
    --ui-menu-bg-active: var(--ls-selection-background-color, var(--rx-blue-10));
    --ui-menu-text-active: var(--ls-selection-text-color, var(--rx-gray-01));
    --neutral-200: var(--ls-secondary-background-color, var(--rx-gray-02));
    --neutral-100: var(--ls-secondary-background-color, var(--rx-gray-02));

    &::part(virtual-keyboard-toggle):hover {
      background-color: var(--ls-primary-background-color, var(--rx-gray-01));
      color: var(--ls-primary-text-color, hsl(var(--primary)));
    }
    /* Hide 'Toggle Virtual Keyboard' tooltip which spoils popup layout */
    &::part(virtual-keyboard-toggle)::after {
      display: none !important;
    }
    &::part(menu-toggle)::after {
      display: none !important;
    }
    &::part(container) {
      min-width: 200px; /* for inline math-field */
    }
  }
}

.ML__keyboard {
  --keyboard-background: var(--ls-secondary-background-color, var(--rx-gray-02));
  --keyboard-accent-color: var(--ls-primary-theme-color, var(--ls-wb-text-color-blue));
  --keyboard-toolbar-text: var(--ls-primary-text-color, hsl(var(--primary)));
  --keyboard-toolbar-background-hover: var(
    --ls-primary-background-color,
    var(--rx-gray-01)
  ) !important;
  --keycap-background: var(--ls-primary-background-color, var(--rx-gray-01));
  --keycap-text: var(--ls-secondary-text-color, var(--rx-gray-11));
  --keycap-secondary-background: var(--ls-tertiary-background-color, var(--rx-gray-03));
  --keycap-secondary-text: var(--ls-secondary-text-color, var(--rx-gray-11));
}

div#mathlive-suggestion-popover {
  background-color: var(--ls-primary-background-color, var(--rx-gray-01));
  z-index: var(--ls-z-index-level-2);

  & ul {
    padding: 8px;
    /* Limit min-width to reduce clutter */
    min-width: 16ch;
    gap: 0.25rem;
  }

  & li {
    /* Suggestion item */
    margin: 0;
    padding: 0.25rem;
    border-radius: 4px;
    width: 100%;
    gap: 0;
    color: var(--ls-secondary-text-color, var(--rx-gray-11));

    &.ML__popover__current {
      background-color: var(--ls-selection-background-color, var(--rx-blue-10));
      color: var(--ls-selection-text-color, var(--rx-gray-01));
    }

    & .ML__popover__latex {
      flex-grow: 1;
      text-align: start;
      margin-right: 0.5rem;
    }

    & .ML__popover__command {
      font-size: 1rem;
    }
  }
}

div#mathlive-suggestion-popover.top-tip::after {
  border-bottom-color: var(--ls-primary-background-color, var(--rx-gray-01));
}

div#mathlive-suggestion-popover.bottom-tip::after {
  border-top-color: var(--ls-primary-background-color, var(--rx-gray-01));
}
`;var jr=[{title:"Triggers",description:"",key:"triggerSettings",type:"heading",default:null},{title:"Enable `$$` trigger",description:"MathLive will popup if `$$` is typed. You can still use inline math.",key:"dollarTrigger",type:"boolean",default:!0},{title:"Enable select-and-edit",description:"Select the math expression (including `$`s) and MathLive will pop up.",key:"selectEdit",type:"boolean",default:!0},{title:"Modifier key for select-and-edit",description:"Require modifier key to be pressed while selecting for MathLive to pop up.",key:"selectModifier",type:"enum",default:"<none>",enumPicker:"select",enumChoices:["<none>","Control","Shift","Alt","Control+Shift","Control+Alt","Shift+Alt"]},{title:"Formatting",description:"",key:"formatSettings",type:"heading",default:null},{title:"Prefer display mode",description:"When enabled, math will be inserted as display mode, i.e. `$$`.",key:"preferDisplay",type:"boolean",default:!1},{title:"Mode switch hotkey",description:"Hotkey to switch between inline and display math.",key:"switchHotkey",type:"string",default:"ctrl+shift+4"},{title:"Prefer multiline for display math",description:"Use `$$\\n...\\n$$` instead of `$$...$$` for display math.",key:"preferMultiline",type:"boolean",default:!1},{title:"Smart format",description:"Determine inline or display mode for new math: inline for middle of the line and display for start of newline (not new block). `preferDisplay` option will be honored in case of ambiguity.",key:"smartFormat",type:"boolean",default:!0},{title:"MathLive",description:"",key:"mathliveSettings",type:"heading",default:null},{title:"Inline preview",description:"Use inline mode of MathLive if current math is inline mode.",key:"inlinePreview",type:"boolean",default:!1},{title:"Smart Fence",description:"Automatically convert parentheses to `\\left...\\right` markup.",key:"smartFence",type:"boolean",default:!0},{title:"Smart mode",description:"Switch to text mode when text input is detected, for example when typing `if x > 0`.",key:"smartMode",type:"boolean",default:!1},{title:"Smart superscript",description:"Automatically move out of a superscript when a digit is typed.",key:"smartSuperscript",type:"boolean",default:!1},{title:"Key bindings",description:"Configure [MathLive keybindings](https://cortexjs.io/mathlive/guides/shortcuts/#key-bindings).\n\nBy default, this plugin includes `ctrl+b` to insert `\\mathbf` as an example. You can add your own and delete this example if you don't want it.\n\nYou can also check [this discussion](https://github.com/AllanChain/logseq-live-math/discussions/14) for more examples.",key:"keybindings",type:"object",default:[{key:"ctrl+b",command:["insert","\\mathbf{#@}"]}]},{title:"Inline shortcuts",description:`Configure [MathLive inline shortcuts](https://cortexjs.io/mathlive/guides/shortcuts/#inline-shortcuts).

By default, this plugin inserts aligned placeholder when you type \`align\` as an example. You can add your own and delete this example if you don't want it.

You can also check [this discussion](https://github.com/AllanChain/logseq-live-math/discussions/14) for more examples.`,key:"inlineShortcuts",type:"object",default:{align:`\\begin{align*}
#? &= #? \\\\
 #? &= #?\\end{align*}`}},{title:"Macros",description:`Configure [MathLive macros](https://cortexjs.io/mathlive/guides/macros/).

One trick is to copy over default macros with \`expand: false\` to avoid automatic macro expansion.

**Note**: MathLive have [bugs](https://github.com/arnog/mathlive/issues/1565) with \`expand: false\`, Use it with caution.

You can also check [this discussion](https://github.com/AllanChain/logseq-live-math/discussions/14) for more examples.`,key:"macros",type:"object",default:{phase:{def:"\\enclose{phasorangle}{#1}",args:1,captureSelection:!1,expand:!1}}},{title:"Disable default shortcuts",description:"Disable default inline shortcuts defined by MathLive.",key:"disableDefaultShortcuts",type:"boolean",default:!1}];var Rr=Er(Fr(),1);function $r(j){j.smartFence=logseq.settings?.smartFence??!0,j.smartMode=logseq.settings?.smartMode??!1,j.smartSuperscript=logseq.settings?.smartSuperscript??!1,j.menuItems=j.menuItems.filter(g=>!g.id?.startsWith("ce-"));try{j.keybindings=[...j.keybindings.filter(g=>!logseq.settings?.keybindings.some(k=>k.key===g.key&&k.ifMode===g.ifMode&&k.ifLayout===g.ifLayout&&k.ifPlatform===g.ifPlatform)),...logseq.settings?.keybindings.filter(g=>!!g.command)]}catch(g){logseq.UI.showMsg(`Fail to configure MathLive keybindings: ${g}`,"error")}try{j.inlineShortcuts={...logseq.settings?.disableDefaultShortcuts?null:j.inlineShortcuts,...logseq.settings?.inlineShortcuts}}catch(g){logseq.UI.showMsg(`Fail to configure MathLive inline shortcuts: ${g}`,"error")}try{j.macros={...j.macros,...logseq.settings?.macros}}catch(g){logseq.UI.showMsg(`Fail to configure MathLive macros: ${g}`,"error")}}async function Nr(j){return new Promise(g=>setTimeout(g,j))}var Zn="logseq-live-math--popup-screen",Se=class j{constructor(){this.mfe=null;this.delimSwitch=null;this.mouseMovement="";this.originalValue="";this.delim="$";this.newline="";this.uuid="";this.contentBefore="";this.contentAfter="";this.originalContent="";this.applyAlign=async()=>{let g=parent.document.getElementById("logseq-live-math--popup");if(g===null)return;let k=await Pr({multiline:this.delim==="$$"&&!!this.newline});k!==void 0&&(Object.entries(k).forEach(([X,S])=>{g.style.setProperty(X,S)}),g.dataset.dx="0",g.dataset.dy="0",g.style.transform="unset")}}static{this.instance=null}static getInstance(){return j.instance===null&&(j.instance=new j),j.instance}static async openInstance(g,k){j.instance&&j.instance.close(),j.instance===null&&(j.instance=new j),await j.instance.open(g,k)}close(){logseq.provideUI({key:"popup",template:""}),this.mfe=null,this.mouseMovement="",this.originalValue="",this.delim="$",this.newline="",this.uuid="",this.contentBefore="",this.contentAfter="",this.originalContent=""}async open(g,k){this.uuid=g,this.extractText(k),this.setupBgScreen(),await this.createPopup(),await Nr(0),this.mfe&&(this.mfe.focus(),$r(this.mfe),await this.applyAlign())}extractText(g){let k=parent.document.querySelector(`textarea[id$="${this.uuid}"]`);if(k==null){console.warn("[live-math] Block changed!");return}let X=k.value,S=g?.selectionEnd??k.selectionEnd,c=g?.selectionStart??k.selectionStart;if(this.delim=logseq.settings?.preferDisplay?"$$":"$",this.newline=logseq.settings?.preferMultiline?`
`:"",g?.searchMath&&c===S)for(let y of X.matchAll(/(\$+)([^$]+)\1/g))y.index<=c&&c<=y.index+y[0].length&&(c=y.index,S=c+y[0].length);for(this.originalContent=k.value.substring(c,S);X.charAt(S)==="$";)S++;for(;X.charAt(c-1)==="$";)c--;if(this.contentBefore=X.substring(0,c),this.contentAfter=X.substring(S,X.length),this.originalContent){let y=this.originalContent.match(/^(?<delim>\$+)(?<newline>\n*)(?<content>.*)\2\1$/s);y!==null&&y.groups!==void 0&&(this.originalValue=y.groups.content,this.delim=y.groups.delim,this.delim!=="$"&&(this.newline=y.groups.newline))}else logseq.settings?.smartFormat&&this.contentBefore.length>0&&(this.contentBefore[this.contentBefore.length-1]===`
`?this.delim="$$":this.delim="$")}setupBgScreen(){let g=parent.document.getElementById(Zn);g!==null&&parent.document.body.removeChild(g);let k=parent.document.createElement("div");k.id=Zn,parent.document.body.appendChild(k),k.addEventListener("click",this.insertLaTeX.bind(this))}async createPopup(){logseq.provideUI({key:"popup",template:"<span></span>",style:await Pr({multiline:this.delim==="$$"&&!!this.newline,renew:!0}),attrs:{title:"Click title to switch display and inline style"}}),await Nr(0);let g=parent.document.getElementById("logseq-live-math--popup");if(g===null)return;let k=g.querySelector(".ls-ui-float-content");if(k===null)return;k.title="",this.mfe=parent.document.createElement("math-field"),this.mfe.style.display="block",k.prepend(this.mfe),this.mfe.value=this.originalValue,logseq.settings?.inlinePreview&&this.delim==="$"&&(this.mfe.defaultMode="inline-math"),this.delimSwitch=parent.document.createElement("button"),this.delimSwitch.innerText=this.delim==="$"?"Inline Math":"Display Math",this.delimSwitch.classList.add("delim-switch"),g.querySelector(".th > .l > h3")?.replaceChildren(this.delimSwitch);let S=parent.document.createElement("div");S.classList.add("actions");let c=parent.document.createElement("button");c.innerHTML="&#xef88; Clear",c.title="Empty this math",c.classList.add("clear-button"),S.appendChild(c);let y=parent.document.createElement("button");y.innerHTML="&#xea0c; Reset",y.title="Reset as before your edit",y.classList.add("reset-button"),this.originalContent.length===0&&(y.disabled=!0),S.appendChild(y);let _=parent.document.createElement("button");_.innerHTML="&#xea5e; Done",_.title="Finish editing",_.classList.add("confirm-button"),S.appendChild(_),k.appendChild(S),parent.addEventListener("resize",this.applyAlign),g.addEventListener("mousedown",s=>s.stopPropagation()),g.querySelector(".draggable-handle")?.addEventListener("mouseup",this.applyAlign),this.delimSwitch.addEventListener("mousedown",s=>{this.mouseMovement=`${s.x},${s.y}`}),this.delimSwitch.addEventListener("mouseup",async s=>{this.mouseMovement===`${s.x},${s.y}`&&(this.mouseMovement="",await this.switchMode())}),this.mfe.addEventListener("keydown",async s=>{let T=logseq.settings?.switchHotkey??"ctrl+shift+4";(0,Rr.isHotkey)(T,s)&&await this.switchMode(),s.stopPropagation()}),this.mfe.addEventListener("pointerdown",s=>s.stopPropagation()),c.addEventListener("click",async()=>{this.mfe&&(this.mfe.value="",await this.updateLaTeX())}),y.addEventListener("click",async()=>{this.mfe&&(this.mfe.value=this.originalContent,await logseq.Editor.updateBlock(this.uuid,this.contentBefore+this.originalContent+this.contentAfter))}),this.mfe.onExport=(s,T,K)=>this.wrapLaTeX(s.getValue(K,"latex-expanded")),this.mfe.addEventListener("input",async()=>{await this.applyAlign(),!(!this.mfe||this.mfe.value.includes("placeholder"))&&await this.updateLaTeX()}),this.mfe.addEventListener("unmount",async()=>{parent.removeEventListener("resize",this.applyAlign);let s=parent.document.getElementById(Zn);s!==null&&parent.document.body.removeChild(s)}),_.addEventListener("click",this.insertLaTeX.bind(this)),this.mfe.addEventListener("change",async()=>{this.mfe?.hasFocus()&&await this.insertLaTeX()}),g.addEventListener("keydown",async s=>{s.target!==this.mfe&&s.key==="Enter"&&await this.insertLaTeX(),s.stopPropagation()})}wrapLaTeX(g){let k=g.match(/^\{\\displaylines(?<content>.*)\}$/s);return k!==null&&k.groups!==void 0&&(g=`\\begin{gather*}${k.groups.content}\\end{gather*}`),g=g.replaceAll("\\placeholder{}",""),this.delim!=="$"&&logseq.settings?.preferMultiline&&(g=g.replaceAll("\\\\ ",`\\\\
`).replaceAll(/(\\begin\{[^}]+\})/g,`
$1
`).replaceAll(/(\\end\{[^}]+\})/g,`
$1
`).replaceAll(/\n+/g,`
`).trim()),this.delim==="$"?this.delim+g+this.delim:this.delim+this.newline+g+this.newline+this.delim}async insertLaTeX(){let g=await this.updateLaTeX(),k=parent.document.querySelector(`textarea[id$="${this.uuid}"]`);k?(k.focus(),k.selectionStart=g.length,k.selectionEnd=g.length):logseq.Editor.editBlock(this.uuid,{pos:g.length}),this.close()}async updateLaTeX(){let g=this.mfe?.value?this.contentBefore+this.wrapLaTeX(this.mfe.getValue("latex-expanded")):this.contentBefore;return await logseq.Editor.updateBlock(this.uuid,g+this.contentAfter),g}async switchMode(){!this.mfe||!this.delimSwitch||(this.delim=this.delim==="$"?"$$":"$",this.delimSwitch.innerText=this.delim==="$"?"Inline Math":"Display Math",logseq.settings?.inlinePreview&&(this.mfe.defaultMode=this.delim==="$"?"inline-math":"math",this.mfe.value=this.mfe.value),await this.updateLaTeX())}};function Ye(j){return parseInt(j.substring(0,j.length-2),10)}async function Pr(j){let k=j?.multiline??!1?60:30,X=20,S=300,c=parent.document.documentElement.clientWidth,y=parent.document.documentElement.clientHeight,_=parent.document.getElementById("logseq-live-math--popup"),s;if(_===null||j?.renew){let T=await logseq.Editor.getEditingCursorPosition();if(T===null){console.error("Error getting cursor pos");return}s={width:S,marginLeft:10,marginRight:10,left:0,top:0,bottom:0},s.left=T.rect.left+T.left-s.width/4-s.marginLeft,s.top=T.rect.top+T.top+k}else{let T=_.querySelector("math-field")?.shadowRoot?.querySelector(".ML__content"),K=T?T.scrollWidth-T.offsetWidth:0;s={width:Math.max(S,_.offsetWidth+K),marginLeft:Ye(_.style.marginLeft),marginRight:Ye(_.style.marginLeft),left:Ye(_.style.left)+parseInt(_.dataset.dx??"0"),top:_.style.top==="initial"?0:Ye(_.style.top)+parseInt(_.dataset.dy??"0"),bottom:_.style.bottom==="initial"?0:Ye(_.style.bottom)-parseInt(_.dataset.dy??"0")}}return s.width+s.marginLeft+s.marginRight>c?(s.left=0,s.width=c-s.marginLeft-s.marginRight):(s.left<0&&(s.left=s.marginLeft),s.left+s.width+s.marginRight>c&&(s.left=c-s.marginRight-s.width)),s.top<0&&(s.top=k),s.bottom<0&&(s.bottom=X),s.top!==0&&s.top+100>y&&(s.bottom=y-s.top+k+X,s.top=0),s.bottom!==0&&s.bottom+100>y&&(s.top=k,s.bottom=0),{left:s.left+"px",top:s.top?s.top+"px":"initial",bottom:s.bottom?s.bottom+"px":"initial",width:s.width+"px",marginLeft:s.marginLeft+"px",marginRight:s.marginRight+"px"}}function zo(){let j=parent.document.createElement("script");return j.setAttribute("src",`${logseq.baseInfo.lsr}dist/parent.js`),parent.document.body.appendChild(j),()=>parent.document.body.removeChild(j)}function Ho(){let j=zo();logseq.provideStyle(Or),logseq.useSettingsSchema(jr),logseq.Editor.registerSlashCommand("math",async k=>{await Se.openInstance(k.uuid)}),logseq.App.registerCommandShortcut({binding:"mod+shift+m",mode:"editing"},async()=>{let k=await logseq.Editor.getCurrentBlock();k!==null&&await Se.openInstance(k.uuid,{searchMath:!0})},{label:"Math trigger",key:"trigger"}),logseq.Editor.onInputSelectionEnd(async k=>{if(logseq.settings?.disabled||!logseq.settings?.selectEdit)return;if(logseq.settings?.selectModifier!=="<none>"){let S=parent.document.body.dataset.activeKeystroke?.split("+"),c=logseq.settings?.selectModifier?.split("+");if(S===void 0||c===void 0||c.some(y=>!S.includes(y)))return}if(k.text.length<=2||!k.text.match(/^(\$+)([^$]+)\1$/))return;let X=await logseq.Editor.getCurrentBlock();X!==null&&await Se.openInstance(X.uuid,{selectionStart:k.start,selectionEnd:k.end})});let g=async k=>{if(logseq.settings?.disabled||!logseq.settings?.dollarTrigger||k.key!=="$")return;let X=await logseq.Editor.getEditingCursorPosition();if(X===null)return;let S=parent.document.getElementById("mock-text")?.textContent,c=await logseq.Editor.getCurrentBlock();c!==null&&X.pos>1&&S?.charAt(X.pos-2)==="$"&&await Se.openInstance(c.uuid)};parent.addEventListener("keydown",g),logseq.beforeunload(async()=>{parent.removeEventListener("keydown",g),j()})}logseq.ready(Ho).catch(logseq.UI.showMsg);})();
/*! Bundled license information:

@logseq/libs/dist/lsplugin.user.js:
  (*! For license information please see lsplugin.user.js.LICENSE.txt *)
*/
